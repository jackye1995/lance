
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Modern columnar format for ML workloads">
      
      
      
        <link rel="canonical" href="https://lancedb.github.io/lance/api/python/">
      
      
        <link rel="prev" href="../api/">
      
      
        <link rel="next" href="../py_modules/">
      
      
      <link rel="icon" href="../../assets/favicon_64x64.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Python API - Lance</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#python-api-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Lance" class="md-header__button md-logo" aria-label="Lance" data-md-component="logo">
      
  <img src="../../assets/high-res-icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lance
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/lancedb/lance" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    lancedb/lance
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Lance" class="md-nav__button md-logo" aria-label="Lance" data-md-component="logo">
      
  <img src="../../assets/high-res-icon.png" alt="logo">

    </a>
    Lance
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lancedb/lance" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    lancedb/lance
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/youtube_transcript_search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    YouTube Transcript Search
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/read_and_write/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read and Write
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/schema_evolution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schema Evolution
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Advanced Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../format/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lance Format Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blob/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blob API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../object_store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Object Store Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../distributed_write/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributed Write
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tokenizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tokenizer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../arrays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extension Arrays
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Integrations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/huggingface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Huggingface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/tensorflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tensorflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/pytorch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyTorch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/ray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ray
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/spark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spark
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/write_read_dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Write/Read Dataset
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/llm_dataset_creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Dataset Creation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/llm_training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Training
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/flickr8k_dataset_creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flickr8k Dataset Creation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/clip_training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLIP Training
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/artefact_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Artefact Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/spark_datasource_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spark DataSource
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API References
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Python API
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Python API
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lance-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Lance Dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lance Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-ios" class="md-nav__link">
    <span class="md-ellipsis">
      Basic IOs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic IOs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-data" class="md-nav__link">
    <span class="md-ellipsis">
      Insert Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.insert" class="md-nav__link">
    <span class="md-ellipsis">
      insert
    </span>
  </a>
  
    <nav class="md-nav" aria-label="insert">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.insert--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scanner" class="md-nav__link">
    <span class="md-ellipsis">
      Scanner
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.scanner" class="md-nav__link">
    <span class="md-ellipsis">
      scanner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scanner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.scanner--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-to-batches" class="md-nav__link">
    <span class="md-ellipsis">
      Convert to Batches
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_batches" class="md-nav__link">
    <span class="md-ellipsis">
      to_batches
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_batches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_batches--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_batches--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Returns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-to-table" class="md-nav__link">
    <span class="md-ellipsis">
      Convert to Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_table" class="md-nav__link">
    <span class="md-ellipsis">
      to_table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_table--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_table--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#random-access" class="md-nav__link">
    <span class="md-ellipsis">
      Random Access
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Random Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#take-rows" class="md-nav__link">
    <span class="md-ellipsis">
      Take Rows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take" class="md-nav__link">
    <span class="md-ellipsis">
      take
    </span>
  </a>
  
    <nav class="md-nav" aria-label="take">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Returns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#take-blobs" class="md-nav__link">
    <span class="md-ellipsis">
      Take Blobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take_blobs" class="md-nav__link">
    <span class="md-ellipsis">
      take_blobs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="take_blobs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take_blobs--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Evolution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Evolution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Add Columns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.add_columns" class="md-nav__link">
    <span class="md-ellipsis">
      add_columns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_columns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.add_columns--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.add_columns--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.add_columns--see-also" class="md-nav__link">
    <span class="md-ellipsis">
      See Also
    </span>
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drop-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Drop Columns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.drop_columns" class="md-nav__link">
    <span class="md-ellipsis">
      drop_columns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="drop_columns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.drop_columns--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.drop_columns--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indexing-and-searching" class="md-nav__link">
    <span class="md-ellipsis">
      Indexing and Searching
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Indexing and Searching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-vector-index" class="md-nav__link">
    <span class="md-ellipsis">
      Create Vector Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_index" class="md-nav__link">
    <span class="md-ellipsis">
      create_index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_index--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_index--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_index--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-scalar-index" class="md-nav__link">
    <span class="md-ellipsis">
      Create Scalar Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_scalar_index" class="md-nav__link">
    <span class="md-ellipsis">
      create_scalar_index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_scalar_index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_scalar_index--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_scalar_index--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drop-index" class="md-nav__link">
    <span class="md-ellipsis">
      Drop Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.drop_index" class="md-nav__link">
    <span class="md-ellipsis">
      drop_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../py_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Modules
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lance-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Lance Dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lance Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-ios" class="md-nav__link">
    <span class="md-ellipsis">
      Basic IOs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic IOs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-data" class="md-nav__link">
    <span class="md-ellipsis">
      Insert Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.insert" class="md-nav__link">
    <span class="md-ellipsis">
      insert
    </span>
  </a>
  
    <nav class="md-nav" aria-label="insert">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.insert--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scanner" class="md-nav__link">
    <span class="md-ellipsis">
      Scanner
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.scanner" class="md-nav__link">
    <span class="md-ellipsis">
      scanner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scanner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.scanner--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-to-batches" class="md-nav__link">
    <span class="md-ellipsis">
      Convert to Batches
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_batches" class="md-nav__link">
    <span class="md-ellipsis">
      to_batches
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_batches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_batches--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_batches--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Returns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-to-table" class="md-nav__link">
    <span class="md-ellipsis">
      Convert to Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_table" class="md-nav__link">
    <span class="md-ellipsis">
      to_table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_table--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.to_table--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#random-access" class="md-nav__link">
    <span class="md-ellipsis">
      Random Access
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Random Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#take-rows" class="md-nav__link">
    <span class="md-ellipsis">
      Take Rows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take" class="md-nav__link">
    <span class="md-ellipsis">
      take
    </span>
  </a>
  
    <nav class="md-nav" aria-label="take">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Returns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#take-blobs" class="md-nav__link">
    <span class="md-ellipsis">
      Take Blobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take_blobs" class="md-nav__link">
    <span class="md-ellipsis">
      take_blobs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="take_blobs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.take_blobs--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Evolution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Evolution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Add Columns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.add_columns" class="md-nav__link">
    <span class="md-ellipsis">
      add_columns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_columns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.add_columns--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.add_columns--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.add_columns--see-also" class="md-nav__link">
    <span class="md-ellipsis">
      See Also
    </span>
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drop-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Drop Columns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.drop_columns" class="md-nav__link">
    <span class="md-ellipsis">
      drop_columns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="drop_columns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.drop_columns--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.drop_columns--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indexing-and-searching" class="md-nav__link">
    <span class="md-ellipsis">
      Indexing and Searching
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Indexing and Searching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-vector-index" class="md-nav__link">
    <span class="md-ellipsis">
      Create Vector Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_index" class="md-nav__link">
    <span class="md-ellipsis">
      create_index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_index--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_index--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_index--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-scalar-index" class="md-nav__link">
    <span class="md-ellipsis">
      Create Scalar Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_scalar_index" class="md-nav__link">
    <span class="md-ellipsis">
      create_scalar_index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_scalar_index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_scalar_index--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.create_scalar_index--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drop-index" class="md-nav__link">
    <span class="md-ellipsis">
      Drop Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lance.dataset.LanceDataset.drop_index" class="md-nav__link">
    <span class="md-ellipsis">
      drop_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="python-api-guide">Python API Guide<a class="headerlink" href="#python-api-guide" title="Permanent link">&para;</a></h1>
<p><code>Lance</code> is a columnar format that is specifically designed for efficient
multi-modal data processing.</p>
<h2 id="lance-dataset">Lance Dataset<a class="headerlink" href="#lance-dataset" title="Permanent link">&para;</a></h2>
<p>The core of Lance is the <code>LanceDataset</code> class. User can open a dataset
by using <a href="../py_modules/#lance.dataset"><code>lance.dataset</code></a>.</p>
<p>For complete API reference, see the <a href="../py_modules/">Python Modules</a> page.</p>
<h3 id="basic-ios">Basic IOs<a class="headerlink" href="#basic-ios" title="Permanent link">&para;</a></h3>
<p>The following functions are used to read and write data in Lance format.</p>
<h4 id="insert-data">Insert Data<a class="headerlink" href="#insert-data" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.insert"></a>
    <div class="doc doc-contents first">

        <p>Insert data into the dataset.</p>
<h3 id="lance.dataset.LanceDataset.insert--parameters">Parameters<a class="headerlink" href="#lance.dataset.LanceDataset.insert--parameters" title="Permanent link">&para;</a></h3>
<p>data_obj: Reader-like
    The data to be written. Acceptable types are:
    - Pandas DataFrame, Pyarrow Table, Dataset, Scanner, or RecordBatchReader
    - Huggingface dataset
mode: str, default 'append'
    The mode to use when writing the data. Options are:
        <strong>create</strong> - create a new dataset (raises if uri already exists).
        <strong>overwrite</strong> - create a new snapshot version
        <strong>append</strong> - create a new version that is the concat of the input the
        latest version (raises if uri does not exist)
**kwargs : dict, optional
    Additional keyword arguments to pass to :func:<code>write_dataset</code>.</p>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1322" name="__codelineno-0-1322"></a><span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">ReaderLike</span><span class="p">,</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a><span class="p">):</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a><span class="sd">    Insert data into the dataset.</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a><span class="sd">    data_obj: Reader-like</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a><span class="sd">        The data to be written. Acceptable types are:</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="sd">        - Pandas DataFrame, Pyarrow Table, Dataset, Scanner, or RecordBatchReader</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a><span class="sd">        - Huggingface dataset</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a><span class="sd">    mode: str, default &#39;append&#39;</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a><span class="sd">        The mode to use when writing the data. Options are:</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a><span class="sd">            **create** - create a new dataset (raises if uri already exists).</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a><span class="sd">            **overwrite** - create a new snapshot version</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a><span class="sd">            **append** - create a new version that is the concat of the input the</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a><span class="sd">            latest version (raises if uri does not exist)</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a><span class="sd">    **kwargs : dict, optional</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a><span class="sd">        Additional keyword arguments to pass to :func:`write_dataset`.</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>    <span class="n">new_ds</span> <span class="o">=</span> <span class="n">write_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span> <span class="o">=</span> <span class="n">new_ds</span><span class="o">.</span><span class="n">_ds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h4 id="scanner">Scanner<a class="headerlink" href="#scanner" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.scanner"></a>
    <div class="doc doc-contents first">

        <p>Return a Scanner that can support various pushdowns.</p>
<h3 id="lance.dataset.LanceDataset.scanner--parameters">Parameters<a class="headerlink" href="#lance.dataset.LanceDataset.scanner--parameters" title="Permanent link">&para;</a></h3>
<p>columns: list of str, or dict of str to str default None
    List of column names to be fetched.
    Or a dictionary of column names to SQL expressions.
    All columns are fetched if None or unspecified.
filter: pa.compute.Expression or str
    Expression or str that is a valid SQL where clause. See
    <code>Lance filter pushdown &lt;https://lancedb.github.io/lance/introduction/read_and_write.html#filter-push-down&gt;</code>_
    for valid SQL expressions.
limit: int, default None
    Fetch up to this many rows. All rows if None or unspecified.
offset: int, default None
    Fetch starting with this row. 0 if None or unspecified.
nearest: dict, default None
    Get the rows corresponding to the K most similar vectors. Example:</p>
<div class="codehilite"><pre><span></span><code>.. code-block:: python

    {
        &quot;column&quot;: &lt;embedding col name&gt;,
        &quot;q&quot;: &lt;query vector as pa.Float32Array&gt;,
        &quot;k&quot;: 10,
        &quot;nprobes&quot;: 1,
        &quot;refine_factor&quot;: 1
    }
</code></pre></div>


<details class="batch_size" open>
  <summary>int, default None</summary>
  <p>The target size of batches returned.  In some cases batches can be up to
twice this size (but never larger than this).  In some cases batches can
be smaller than this size.</p>
</details>        <p>io_buffer_size: int, default None
    The size of the IO buffer.  See <code>ScannerBuilder.io_buffer_size</code>
    for more information.
batch_readahead: int, optional
    The number of batches to read ahead.
fragment_readahead: int, optional
    The number of fragments to read ahead.
scan_in_order: bool, default True
    Whether to read the fragments and batches in order. If false,
    throughput may be higher, but batches will be returned out of order
    and memory use might increase.
fragments: iterable of LanceFragment, default None
    If specified, only scan these fragments. If scan_in_order is True, then
    the fragments will be scanned in the order given.
prefilter: bool, default False
    If True then the filter will be applied before the vector query is run.
    This will generate more correct results but it may be a more costly
    query.  It's generally good when the filter is highly selective.</p>
<div class="codehilite"><pre><span></span><code>If False then the filter will be applied after the vector query is run.
This will perform well but the results may have fewer than the requested
number of rows (or be empty) if the rows closest to the query do not
match the filter.  It&#39;s generally good when the filter is not very
selective.
</code></pre></div>

<p>use_scalar_index: bool, default True
    Lance will automatically use scalar indices to optimize a query.  In some
    corner cases this can make query performance worse and this parameter can
    be used to disable scalar indices in these cases.
late_materialization: bool or List[str], default None
    Allows custom control over late materialization.  Late materialization
    fetches non-query columns using a take operation after the filter.  This
    is useful when there are few results or columns are very large.</p>
<div class="codehilite"><pre><span></span><code>Early materialization can be better when there are many results or the
columns are very narrow.

If True, then all columns are late materialized.
If False, then all columns are early materialized.
If a list of strings, then only the columns in the list are
late materialized.

The default uses a heuristic that assumes filters will select about 0.1%
of the rows.  If your filter is more selective (e.g. find by id) you may
want to set this to True.  If your filter is not very selective (e.g.
matches 20% of the rows) you may want to set this to False.
</code></pre></div>

<p>full_text_query: str or dict, optional
    query string to search for, the results will be ranked by BM25.
    e.g. "hello world", would match documents containing "hello" or "world".
    or a dictionary with the following keys:</p>
<div class="codehilite"><pre><span></span><code>- columns: list[str]
    The columns to search,
    currently only supports a single column in the columns list.
- query: str
    The query string to search for.
</code></pre></div>

<p>fast_search:  bool, default False
    If True, then the search will only be performed on the indexed data, which
    yields faster search time.
scan_stats_callback: Callable[[ScanStatistics], None], default None
    A callback function that will be called with the scan statistics after the
    scan is complete.  Errors raised by the callback will be logged but not
    re-raised.
include_deleted_rows: bool, default False
    If True, then rows that have been deleted, but are still present in the
    fragment, will be returned.  These rows will have the _rowid column set
    to null.  All other columns will reflect the value stored on disk and may
    not be null.</p>
<div class="codehilite"><pre><span></span><code>Note: if this is a search operation, or a take operation (including scalar
indexed scans) then deleted rows cannot be returned.
</code></pre></div>

<p>.. note::</p>
<div class="codehilite"><pre><span></span><code>For now, if BOTH filter and nearest is specified, then:

1. nearest is executed first.
2. The results are filtered afterwards.
</code></pre></div>

<p>For debugging ANN results, you can choose to not use the index
even if present by specifying <code>use_index=False</code>. For example,
the following will always return exact KNN results:</p>
<p>.. code-block:: python</p>
<div class="codehilite"><pre><span></span><code>dataset.to_table(nearest={
    &quot;column&quot;: &quot;vector&quot;,
    &quot;k&quot;: 10,
    &quot;q&quot;: &lt;query vector&gt;,
    &quot;use_index&quot;: False
}
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="k">def</span><span class="w"> </span><span class="nf">scanner</span><span class="p">(</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="n">columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">Expression</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="n">nearest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="n">batch_readahead</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="n">fragment_readahead</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="n">scan_in_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="n">fragments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">LanceFragment</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">full_text_query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">FullTextQuery</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="n">with_row_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="n">with_row_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="n">use_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="n">fast_search</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="n">io_buffer_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="n">late_materialization</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="n">use_scalar_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="n">include_deleted_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="n">scan_stats_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">ScanStatistics</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="n">strict_batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LanceScanner</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a Scanner that can support various pushdowns.</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">    columns: list of str, or dict of str to str default None</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">        List of column names to be fetched.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">        Or a dictionary of column names to SQL expressions.</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        All columns are fetched if None or unspecified.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    filter: pa.compute.Expression or str</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        Expression or str that is a valid SQL where clause. See</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        `Lance filter pushdown &lt;https://lancedb.github.io/lance/introduction/read_and_write.html#filter-push-down&gt;`_</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        for valid SQL expressions.</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">    limit: int, default None</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        Fetch up to this many rows. All rows if None or unspecified.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">    offset: int, default None</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        Fetch starting with this row. 0 if None or unspecified.</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">    nearest: dict, default None</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        Get the rows corresponding to the K most similar vectors. Example:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        .. code-block:: python</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">            {</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">                &quot;column&quot;: &lt;embedding col name&gt;,</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">                &quot;q&quot;: &lt;query vector as pa.Float32Array&gt;,</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">                &quot;k&quot;: 10,</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">                &quot;nprobes&quot;: 1,</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">                &quot;refine_factor&quot;: 1</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">            }</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">    batch_size: int, default None</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">        The target size of batches returned.  In some cases batches can be up to</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">        twice this size (but never larger than this).  In some cases batches can</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        be smaller than this size.</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">    io_buffer_size: int, default None</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">        The size of the IO buffer.  See ``ScannerBuilder.io_buffer_size``</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">        for more information.</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">    batch_readahead: int, optional</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">        The number of batches to read ahead.</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    fragment_readahead: int, optional</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">        The number of fragments to read ahead.</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">    scan_in_order: bool, default True</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">        Whether to read the fragments and batches in order. If false,</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">        throughput may be higher, but batches will be returned out of order</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">        and memory use might increase.</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    fragments: iterable of LanceFragment, default None</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">        If specified, only scan these fragments. If scan_in_order is True, then</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">        the fragments will be scanned in the order given.</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    prefilter: bool, default False</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">        If True then the filter will be applied before the vector query is run.</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">        This will generate more correct results but it may be a more costly</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        query.  It&#39;s generally good when the filter is highly selective.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">        If False then the filter will be applied after the vector query is run.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">        This will perform well but the results may have fewer than the requested</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">        number of rows (or be empty) if the rows closest to the query do not</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        match the filter.  It&#39;s generally good when the filter is not very</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">        selective.</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">    use_scalar_index: bool, default True</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">        Lance will automatically use scalar indices to optimize a query.  In some</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        corner cases this can make query performance worse and this parameter can</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">        be used to disable scalar indices in these cases.</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    late_materialization: bool or List[str], default None</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        Allows custom control over late materialization.  Late materialization</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        fetches non-query columns using a take operation after the filter.  This</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        is useful when there are few results or columns are very large.</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        Early materialization can be better when there are many results or the</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        columns are very narrow.</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        If True, then all columns are late materialized.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">        If False, then all columns are early materialized.</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">        If a list of strings, then only the columns in the list are</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">        late materialized.</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">        The default uses a heuristic that assumes filters will select about 0.1%</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">        of the rows.  If your filter is more selective (e.g. find by id) you may</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        want to set this to True.  If your filter is not very selective (e.g.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">        matches 20% of the rows) you may want to set this to False.</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">    full_text_query: str or dict, optional</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        query string to search for, the results will be ranked by BM25.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">        e.g. &quot;hello world&quot;, would match documents containing &quot;hello&quot; or &quot;world&quot;.</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        or a dictionary with the following keys:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        - columns: list[str]</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">            The columns to search,</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">            currently only supports a single column in the columns list.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">        - query: str</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">            The query string to search for.</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">    fast_search:  bool, default False</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        If True, then the search will only be performed on the indexed data, which</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        yields faster search time.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    scan_stats_callback: Callable[[ScanStatistics], None], default None</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        A callback function that will be called with the scan statistics after the</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        scan is complete.  Errors raised by the callback will be logged but not</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        re-raised.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    include_deleted_rows: bool, default False</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        If True, then rows that have been deleted, but are still present in the</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        fragment, will be returned.  These rows will have the _rowid column set</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">        to null.  All other columns will reflect the value stored on disk and may</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">        not be null.</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">        Note: if this is a search operation, or a take operation (including scalar</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">        indexed scans) then deleted rows cannot be returned.</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    .. note::</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">        For now, if BOTH filter and nearest is specified, then:</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">        1. nearest is executed first.</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">        2. The results are filtered afterwards.</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">    For debugging ANN results, you can choose to not use the index</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">    even if present by specifying ``use_index=False``. For example,</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">    the following will always return exact KNN results:</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    .. code-block:: python</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">        dataset.to_table(nearest={</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">            &quot;column&quot;: &quot;vector&quot;,</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">            &quot;k&quot;: 10,</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">            &quot;q&quot;: &lt;query vector&gt;,</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">            &quot;use_index&quot;: False</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        }</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="n">builder</span> <span class="o">=</span> <span class="n">ScannerBuilder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="n">builder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_default_scan_options</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="c1"># Calls the setter if the user provided a non-None value</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>    <span class="c1"># We need to avoid calling the setter with a None value so</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="c1"># we don&#39;t override any defaults from _default_scan_options</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setopt</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="n">opt</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">filter</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">prefilter</span><span class="p">,</span> <span class="n">prefilter</span><span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">io_buffer_size</span><span class="p">,</span> <span class="n">io_buffer_size</span><span class="p">)</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">batch_readahead</span><span class="p">,</span> <span class="n">batch_readahead</span><span class="p">)</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">fragment_readahead</span><span class="p">,</span> <span class="n">fragment_readahead</span><span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">scan_in_order</span><span class="p">,</span> <span class="n">scan_in_order</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">with_fragments</span><span class="p">,</span> <span class="n">fragments</span><span class="p">)</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">late_materialization</span><span class="p">,</span> <span class="n">late_materialization</span><span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">with_row_id</span><span class="p">,</span> <span class="n">with_row_id</span><span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">with_row_address</span><span class="p">,</span> <span class="n">with_row_address</span><span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">use_stats</span><span class="p">,</span> <span class="n">use_stats</span><span class="p">)</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">use_scalar_index</span><span class="p">,</span> <span class="n">use_scalar_index</span><span class="p">)</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">fast_search</span><span class="p">,</span> <span class="n">fast_search</span><span class="p">)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">include_deleted_rows</span><span class="p">,</span> <span class="n">include_deleted_rows</span><span class="p">)</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">scan_stats_callback</span><span class="p">,</span> <span class="n">scan_stats_callback</span><span class="p">)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="n">setopt</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">strict_batch_size</span><span class="p">,</span> <span class="n">strict_batch_size</span><span class="p">)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="c1"># columns=None has a special meaning. we can&#39;t treat it as &quot;user didn&#39;t specify&quot;</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_scan_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="c1"># No defaults, use user-provided, if any</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="n">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="n">default_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_scan_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>        <span class="k">if</span> <span class="n">default_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>            <span class="c1"># No default_columns, use user-provided, if any</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="n">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>            <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                <span class="c1"># User supplied None, fallback to default (no way to override</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                <span class="c1"># default to None)</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="n">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>                <span class="c1"># User supplied non-None, use that</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>                <span class="n">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="n">default_columns</span><span class="p">)</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>    <span class="k">if</span> <span class="n">full_text_query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">full_text_query</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">FullTextQuery</span><span class="p">)):</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>            <span class="n">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">full_text_search</span><span class="p">(</span><span class="n">full_text_query</span><span class="p">)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">full_text_query</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="n">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">full_text_search</span><span class="p">(</span><span class="o">**</span><span class="n">full_text_query</span><span class="p">)</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="k">if</span> <span class="n">nearest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="n">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">nearest</span><span class="p">(</span><span class="o">**</span><span class="n">nearest</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">to_scanner</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h4 id="convert-to-batches">Convert to Batches<a class="headerlink" href="#convert-to-batches" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.to_batches"></a>
    <div class="doc doc-contents first">

        <p>Read the dataset as materialized record batches.</p>
<h3 id="lance.dataset.LanceDataset.to_batches--parameters">Parameters<a class="headerlink" href="#lance.dataset.LanceDataset.to_batches--parameters" title="Permanent link">&para;</a></h3>
<p>**kwargs : dict, optional
    Arguments for <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />meth:<code>~LanceDataset.scanner</code>.</p>
<h3 id="lance.dataset.LanceDataset.to_batches--returns">Returns<a class="headerlink" href="#lance.dataset.LanceDataset.to_batches--returns" title="Permanent link">&para;</a></h3>
<p>record_batches : Iterator of <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />class:<code>~pyarrow.RecordBatch</code></p>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="k">def</span><span class="w"> </span><span class="nf">to_batches</span><span class="p">(</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>    <span class="n">columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">Expression</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>    <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>    <span class="n">nearest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>    <span class="n">batch_readahead</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="n">fragment_readahead</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>    <span class="n">scan_in_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>    <span class="n">with_row_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>    <span class="n">with_row_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>    <span class="n">use_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>    <span class="n">full_text_query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>    <span class="n">io_buffer_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="n">late_materialization</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>    <span class="n">use_scalar_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>    <span class="n">strict_batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">pa</span><span class="o">.</span><span class="n">RecordBatch</span><span class="p">]:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the dataset as materialized record batches.</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="sd">    **kwargs : dict, optional</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">        Arguments for :py:meth:`~LanceDataset.scanner`.</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="sd">    -------</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">    record_batches : Iterator of :py:class:`~pyarrow.RecordBatch`</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanner</span><span class="p">(</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>        <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>        <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>        <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="n">nearest</span><span class="o">=</span><span class="n">nearest</span><span class="p">,</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>        <span class="n">io_buffer_size</span><span class="o">=</span><span class="n">io_buffer_size</span><span class="p">,</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="n">batch_readahead</span><span class="o">=</span><span class="n">batch_readahead</span><span class="p">,</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>        <span class="n">fragment_readahead</span><span class="o">=</span><span class="n">fragment_readahead</span><span class="p">,</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="n">late_materialization</span><span class="o">=</span><span class="n">late_materialization</span><span class="p">,</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>        <span class="n">use_scalar_index</span><span class="o">=</span><span class="n">use_scalar_index</span><span class="p">,</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>        <span class="n">scan_in_order</span><span class="o">=</span><span class="n">scan_in_order</span><span class="p">,</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter</span><span class="p">,</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>        <span class="n">with_row_id</span><span class="o">=</span><span class="n">with_row_id</span><span class="p">,</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>        <span class="n">with_row_address</span><span class="o">=</span><span class="n">with_row_address</span><span class="p">,</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>        <span class="n">use_stats</span><span class="o">=</span><span class="n">use_stats</span><span class="p">,</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>        <span class="n">full_text_query</span><span class="o">=</span><span class="n">full_text_query</span><span class="p">,</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>        <span class="n">strict_batch_size</span><span class="o">=</span><span class="n">strict_batch_size</span><span class="p">,</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>    <span class="p">)</span><span class="o">.</span><span class="n">to_batches</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h4 id="convert-to-table">Convert to Table<a class="headerlink" href="#convert-to-table" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.to_table"></a>
    <div class="doc doc-contents first">

        <p>Read the data into memory as a <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />class:<code>pyarrow.Table</code></p>
<h3 id="lance.dataset.LanceDataset.to_table--parameters">Parameters<a class="headerlink" href="#lance.dataset.LanceDataset.to_table--parameters" title="Permanent link">&para;</a></h3>
<p>columns: list of str, or dict of str to str default None
    List of column names to be fetched.
    Or a dictionary of column names to SQL expressions.
    All columns are fetched if None or unspecified.
filter : pa.compute.Expression or str
    Expression or str that is a valid SQL where clause. See
    <code>Lance filter pushdown &lt;https://lancedb.github.io/lance/introduction/read_and_write.html#filter-push-down&gt;</code>_
    for valid SQL expressions.
limit: int, default None
    Fetch up to this many rows. All rows if None or unspecified.
offset: int, default None
    Fetch starting with this row. 0 if None or unspecified.
nearest: dict, default None
    Get the rows corresponding to the K most similar vectors. Example:</p>
<div class="codehilite"><pre><span></span><code>.. code-block:: python

    {
        &quot;column&quot;: &lt;embedding col name&gt;,
        &quot;q&quot;: &lt;query vector as pa.Float32Array&gt;,
        &quot;k&quot;: 10,
        &quot;metric&quot;: &quot;cosine&quot;,
        &quot;nprobes&quot;: 1,
        &quot;refine_factor&quot;: 1
    }
</code></pre></div>


<details class="batch_size" open>
  <summary>int, optional</summary>
  <p>The number of rows to read at a time.</p>
</details>        <p>io_buffer_size: int, default None
    The size of the IO buffer.  See <code>ScannerBuilder.io_buffer_size</code>
    for more information.
batch_readahead: int, optional
    The number of batches to read ahead.
fragment_readahead: int, optional
    The number of fragments to read ahead.
scan_in_order: bool, optional, default True
    Whether to read the fragments and batches in order. If false,
    throughput may be higher, but batches will be returned out of order
    and memory use might increase.
prefilter: bool, optional, default False
    Run filter before the vector search.
late_materialization: bool or List[str], default None
    Allows custom control over late materialization.  See
    <code>ScannerBuilder.late_materialization</code> for more information.
use_scalar_index: bool, default True
    Allows custom control over scalar index usage.  See
    <code>ScannerBuilder.use_scalar_index</code> for more information.
with_row_id: bool, optional, default False
    Return row ID.
with_row_address: bool, optional, default False
    Return row address
use_stats: bool, optional, default True
    Use stats pushdown during filters.
fast_search: bool, optional, default False
full_text_query: str or dict, optional
    query string to search for, the results will be ranked by BM25.
    e.g. "hello world", would match documents contains "hello" or "world".
    or a dictionary with the following keys:</p>
<div class="codehilite"><pre><span></span><code>- columns: list[str]
    The columns to search,
    currently only supports a single column in the columns list.
- query: str
    The query string to search for.
</code></pre></div>

<p>include_deleted_rows: bool, optional, default False
    If True, then rows that have been deleted, but are still present in the
    fragment, will be returned.  These rows will have the _rowid column set
    to null.  All other columns will reflect the value stored on disk and may
    not be null.</p>
<div class="codehilite"><pre><span></span><code>Note: if this is a search operation, or a take operation (including scalar
indexed scans) then deleted rows cannot be returned.
</code></pre></div>

<h3 id="lance.dataset.LanceDataset.to_table--notes">Notes<a class="headerlink" href="#lance.dataset.LanceDataset.to_table--notes" title="Permanent link">&para;</a></h3>
<p>If BOTH filter and nearest is specified, then:</p>
<ol>
<li>nearest is executed first.</li>
<li>The results are filtered afterward, unless pre-filter sets to True.</li>
</ol>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="k">def</span><span class="w"> </span><span class="nf">to_table</span><span class="p">(</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="n">columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">Expression</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>    <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="n">nearest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="n">batch_readahead</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="n">fragment_readahead</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="n">scan_in_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>    <span class="n">with_row_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="n">with_row_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="n">use_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="n">fast_search</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="n">full_text_query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">FullTextQuery</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="n">io_buffer_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="n">late_materialization</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="n">use_scalar_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>    <span class="n">include_deleted_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pa</span><span class="o">.</span><span class="n">Table</span><span class="p">:</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the data into memory as a :py:class:`pyarrow.Table`</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">    columns: list of str, or dict of str to str default None</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">        List of column names to be fetched.</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">        Or a dictionary of column names to SQL expressions.</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="sd">        All columns are fetched if None or unspecified.</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">    filter : pa.compute.Expression or str</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">        Expression or str that is a valid SQL where clause. See</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">        `Lance filter pushdown &lt;https://lancedb.github.io/lance/introduction/read_and_write.html#filter-push-down&gt;`_</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a><span class="sd">        for valid SQL expressions.</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">    limit: int, default None</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">        Fetch up to this many rows. All rows if None or unspecified.</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">    offset: int, default None</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="sd">        Fetch starting with this row. 0 if None or unspecified.</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">    nearest: dict, default None</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">        Get the rows corresponding to the K most similar vectors. Example:</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">        .. code-block:: python</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">            {</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">                &quot;column&quot;: &lt;embedding col name&gt;,</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">                &quot;q&quot;: &lt;query vector as pa.Float32Array&gt;,</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">                &quot;k&quot;: 10,</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">                &quot;metric&quot;: &quot;cosine&quot;,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">                &quot;nprobes&quot;: 1,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">                &quot;refine_factor&quot;: 1</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">            }</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">    batch_size: int, optional</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">        The number of rows to read at a time.</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">    io_buffer_size: int, default None</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">        The size of the IO buffer.  See ``ScannerBuilder.io_buffer_size``</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">        for more information.</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">    batch_readahead: int, optional</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">        The number of batches to read ahead.</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">    fragment_readahead: int, optional</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">        The number of fragments to read ahead.</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">    scan_in_order: bool, optional, default True</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">        Whether to read the fragments and batches in order. If false,</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">        throughput may be higher, but batches will be returned out of order</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">        and memory use might increase.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">    prefilter: bool, optional, default False</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">        Run filter before the vector search.</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    late_materialization: bool or List[str], default None</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">        Allows custom control over late materialization.  See</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">        ``ScannerBuilder.late_materialization`` for more information.</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">    use_scalar_index: bool, default True</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        Allows custom control over scalar index usage.  See</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">        ``ScannerBuilder.use_scalar_index`` for more information.</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">    with_row_id: bool, optional, default False</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">        Return row ID.</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">    with_row_address: bool, optional, default False</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">        Return row address</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">    use_stats: bool, optional, default True</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">        Use stats pushdown during filters.</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">    fast_search: bool, optional, default False</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">    full_text_query: str or dict, optional</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">        query string to search for, the results will be ranked by BM25.</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">        e.g. &quot;hello world&quot;, would match documents contains &quot;hello&quot; or &quot;world&quot;.</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">        or a dictionary with the following keys:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        - columns: list[str]</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">            The columns to search,</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">            currently only supports a single column in the columns list.</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        - query: str</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">            The query string to search for.</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">    include_deleted_rows: bool, optional, default False</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">        If True, then rows that have been deleted, but are still present in the</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">        fragment, will be returned.  These rows will have the _rowid column set</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">        to null.  All other columns will reflect the value stored on disk and may</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        not be null.</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">        Note: if this is a search operation, or a take operation (including scalar</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">        indexed scans) then deleted rows cannot be returned.</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">    -----</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">    If BOTH filter and nearest is specified, then:</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">    1. nearest is executed first.</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">    2. The results are filtered afterward, unless pre-filter sets to True.</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanner</span><span class="p">(</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="n">nearest</span><span class="o">=</span><span class="n">nearest</span><span class="p">,</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="n">io_buffer_size</span><span class="o">=</span><span class="n">io_buffer_size</span><span class="p">,</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="n">batch_readahead</span><span class="o">=</span><span class="n">batch_readahead</span><span class="p">,</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="n">fragment_readahead</span><span class="o">=</span><span class="n">fragment_readahead</span><span class="p">,</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="n">late_materialization</span><span class="o">=</span><span class="n">late_materialization</span><span class="p">,</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="n">use_scalar_index</span><span class="o">=</span><span class="n">use_scalar_index</span><span class="p">,</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="n">scan_in_order</span><span class="o">=</span><span class="n">scan_in_order</span><span class="p">,</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter</span><span class="p">,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>        <span class="n">with_row_id</span><span class="o">=</span><span class="n">with_row_id</span><span class="p">,</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="n">with_row_address</span><span class="o">=</span><span class="n">with_row_address</span><span class="p">,</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>        <span class="n">use_stats</span><span class="o">=</span><span class="n">use_stats</span><span class="p">,</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="n">fast_search</span><span class="o">=</span><span class="n">fast_search</span><span class="p">,</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>        <span class="n">full_text_query</span><span class="o">=</span><span class="n">full_text_query</span><span class="p">,</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="n">include_deleted_rows</span><span class="o">=</span><span class="n">include_deleted_rows</span><span class="p">,</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>    <span class="p">)</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="random-access">Random Access<a class="headerlink" href="#random-access" title="Permanent link">&para;</a></h3>
<p>Lance stands out with its super fast random access, unlike other
columnar formats.</p>
<h4 id="take-rows">Take Rows<a class="headerlink" href="#take-rows" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.take"></a>
    <div class="doc doc-contents first">

        <p>Select rows of data by index.</p>
<h3 id="lance.dataset.LanceDataset.take--parameters">Parameters<a class="headerlink" href="#lance.dataset.LanceDataset.take--parameters" title="Permanent link">&para;</a></h3>
<p>indices : Array or array-like
    indices of rows to select in the dataset.
columns: list of str, or dict of str to str default None
    List of column names to be fetched.
    Or a dictionary of column names to SQL expressions.
    All columns are fetched if None or unspecified.</p>
<h3 id="lance.dataset.LanceDataset.take--returns">Returns<a class="headerlink" href="#lance.dataset.LanceDataset.take--returns" title="Permanent link">&para;</a></h3>
<p>table : pyarrow.Table</p>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="k">def</span><span class="w"> </span><span class="nf">take</span><span class="p">(</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">pa</span><span class="o">.</span><span class="n">Array</span><span class="p">],</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>    <span class="n">columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pa</span><span class="o">.</span><span class="n">Table</span><span class="p">:</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select rows of data by index.</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a><span class="sd">    indices : Array or array-like</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="sd">        indices of rows to select in the dataset.</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="sd">    columns: list of str, or dict of str to str default None</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a><span class="sd">        List of column names to be fetched.</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">        Or a dictionary of column names to SQL expressions.</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">        All columns are fetched if None or unspecified.</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">    -------</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">    table : pyarrow.Table</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>    <span class="n">columns_with_transform</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>        <span class="n">columns_with_transform</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>        <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>    <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">from_batches</span><span class="p">(</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">columns_with_transform</span><span class="p">)]</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h4 id="take-blobs">Take Blobs<a class="headerlink" href="#take-blobs" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.take_blobs"></a>
    <div class="doc doc-contents first">

        <p>Select blobs by row IDs.</p>
<p>Instead of loading large binary blob data into memory before processing it,
this API allows you to open binary blob data as a regular Python file-like
object. For more details, see <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />class:<code>lance.BlobFile</code>.</p>
<p>Exactly one of ids, addresses, or indices must be specified.
Parameters</p>
<hr />
<p>blob_column : str
    The name of the blob column to select.
ids : Integer Array or array-like
    row IDs to select in the dataset.
addresses: Integer Array or array-like
    The (unstable) row addresses to select in the dataset.
indices : Integer Array or array-like
    The offset / indices of the row in the dataset.</p>
<h3 id="lance.dataset.LanceDataset.take_blobs--returns">Returns<a class="headerlink" href="#lance.dataset.LanceDataset.take_blobs--returns" title="Permanent link">&para;</a></h3>
<p>blob_files : List[BlobFile]</p>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span>
<span class="normal"><a href="#__codelineno-0-977">977</a></span>
<span class="normal"><a href="#__codelineno-0-978">978</a></span>
<span class="normal"><a href="#__codelineno-0-979">979</a></span>
<span class="normal"><a href="#__codelineno-0-980">980</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="k">def</span><span class="w"> </span><span class="nf">take_blobs</span><span class="p">(</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span class="n">blob_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>    <span class="n">ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">pa</span><span class="o">.</span><span class="n">Array</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>    <span class="n">addresses</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">pa</span><span class="o">.</span><span class="n">Array</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">pa</span><span class="o">.</span><span class="n">Array</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BlobFile</span><span class="p">]:</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">    Select blobs by row IDs.</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">    Instead of loading large binary blob data into memory before processing it,</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">    this API allows you to open binary blob data as a regular Python file-like</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">    object. For more details, see :py:class:`lance.BlobFile`.</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">    Exactly one of ids, addresses, or indices must be specified.</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">    blob_column : str</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="sd">        The name of the blob column to select.</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="sd">    ids : Integer Array or array-like</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">        row IDs to select in the dataset.</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a><span class="sd">    addresses: Integer Array or array-like</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">        The (unstable) row addresses to select in the dataset.</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">    indices : Integer Array or array-like</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">        The offset / indices of the row in the dataset.</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">    -------</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">    blob_files : List[BlobFile]</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">bool</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ids</span><span class="p">,</span> <span class="n">addresses</span><span class="p">,</span> <span class="n">indices</span><span class="p">]])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>            <span class="s2">&quot;Exactly one of ids, indices, or addresses must be specified&quot;</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>        <span class="p">)</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="n">lance_blob_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">take_blobs</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">blob_column</span><span class="p">)</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="k">elif</span> <span class="n">addresses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="c1"># ROW ids and Row address are the same until stable ROW ID is implemented.</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="n">lance_blob_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">take_blobs</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">blob_column</span><span class="p">)</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>    <span class="k">elif</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="n">lance_blob_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">take_blobs_by_indices</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">blob_column</span><span class="p">)</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either ids or indices must be specified&quot;</span><span class="p">)</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">BlobFile</span><span class="p">(</span><span class="n">lance_blob_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">lance_blob_file</span> <span class="ow">in</span> <span class="n">lance_blob_files</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="schema-evolution">Schema Evolution<a class="headerlink" href="#schema-evolution" title="Permanent link">&para;</a></h3>
<p>Lance supports schema evolution, which means that you can add new
columns to the dataset cheaply.</p>
<h4 id="add-columns">Add Columns<a class="headerlink" href="#add-columns" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.add_columns"></a>
    <div class="doc doc-contents first">

        <p>Add new columns with defined values.</p>
<p>There are several ways to specify the new columns. First, you can provide
SQL expressions for each new column. Second you can provide a UDF that
takes a batch of existing data and returns a new batch with the new
columns. These new columns will be appended to the dataset.</p>
<p>You can also provide a RecordBatchReader which will read the new column
values from some external source.  This is often useful when the new column
values have already been staged to files (often by some distributed process)</p>
<p>See the :func:<code>lance.add_columns_udf</code> decorator for more information on
writing UDFs.</p>
<h3 id="lance.dataset.LanceDataset.add_columns--parameters">Parameters<a class="headerlink" href="#lance.dataset.LanceDataset.add_columns--parameters" title="Permanent link">&para;</a></h3>
<p>transforms : dict or AddColumnsUDF or ReaderLike
    If this is a dictionary, then the keys are the names of the new
    columns and the values are SQL expression strings. These strings can
    reference existing columns in the dataset.
    If this is a AddColumnsUDF, then it is a UDF that takes a batch of
    existing data and returns a new batch with the new columns.
    If this is :class:<code>pyarrow.Field</code> or :class:<code>pyarrow.Schema</code>, it adds
    all NULL columns with the given schema, in a metadata-only operation.
read_columns : list of str, optional
    The names of the columns that the UDF will read. If None, then the
    UDF will read all columns. This is only used when transforms is a
    UDF. Otherwise, the read columns are inferred from the SQL expressions.
reader_schema: pa.Schema, optional
    Only valid if transforms is a <code>ReaderLike</code> object.  This will be used to
    determine the schema of the reader.
batch_size: int, optional
    The number of rows to read at a time from the source dataset when applying
    the transform.  This is ignored if the dataset is a v1 dataset.</p>
<h3 id="lance.dataset.LanceDataset.add_columns--examples">Examples<a class="headerlink" href="#lance.dataset.LanceDataset.add_columns--examples" title="Permanent link">&para;</a></h3>
<blockquote>
<blockquote>
<blockquote>
<p>import lance
import pyarrow as pa
table = pa.table({"a": [1, 2, 3]})
dataset = lance.write_dataset(table, "my_dataset")
<a class="magiclink magiclink-github magiclink-mention" href="https://github.com/lance" title="GitHub User: lance">@lance</a>.batch_udf()
... def double_a(batch):
...     df = batch.to_pandas()
...     return pd.DataFrame({'double_a': 2 * df['a']})
dataset.add_columns(double_a)
dataset.to_table().to_pandas()
   a  double_a
0  1         2
1  2         4
2  3         6
dataset.add_columns({"triple_a": "a * 3"})
dataset.to_table().to_pandas()
   a  double_a  triple_a
0  1         2         3
1  2         4         6
2  3         6         9</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="lance.dataset.LanceDataset.add_columns--see-also">See Also<a class="headerlink" href="#lance.dataset.LanceDataset.add_columns--see-also" title="Permanent link">&para;</a></h3>
<p>LanceDataset.merge :
    Merge a pre-computed set of columns into the dataset.</p>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_columns</span><span class="p">(</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>    <span class="n">transforms</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>    <span class="o">|</span> <span class="n">BatchUDF</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>    <span class="o">|</span> <span class="n">ReaderLike</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>    <span class="o">|</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">Field</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>    <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">pyarrow</span><span class="o">.</span><span class="n">Field</span><span class="p">]</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>    <span class="o">|</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">Schema</span><span class="p">,</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>    <span class="n">read_columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>    <span class="n">reader_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pa</span><span class="o">.</span><span class="n">Schema</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a><span class="p">):</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a><span class="sd">    Add new columns with defined values.</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><span class="sd">    There are several ways to specify the new columns. First, you can provide</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a><span class="sd">    SQL expressions for each new column. Second you can provide a UDF that</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a><span class="sd">    takes a batch of existing data and returns a new batch with the new</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a><span class="sd">    columns. These new columns will be appended to the dataset.</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a><span class="sd">    You can also provide a RecordBatchReader which will read the new column</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a><span class="sd">    values from some external source.  This is often useful when the new column</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a><span class="sd">    values have already been staged to files (often by some distributed process)</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a><span class="sd">    See the :func:`lance.add_columns_udf` decorator for more information on</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a><span class="sd">    writing UDFs.</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a><span class="sd">    transforms : dict or AddColumnsUDF or ReaderLike</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a><span class="sd">        If this is a dictionary, then the keys are the names of the new</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a><span class="sd">        columns and the values are SQL expression strings. These strings can</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a><span class="sd">        reference existing columns in the dataset.</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a><span class="sd">        If this is a AddColumnsUDF, then it is a UDF that takes a batch of</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a><span class="sd">        existing data and returns a new batch with the new columns.</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a><span class="sd">        If this is :class:`pyarrow.Field` or :class:`pyarrow.Schema`, it adds</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a><span class="sd">        all NULL columns with the given schema, in a metadata-only operation.</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a><span class="sd">    read_columns : list of str, optional</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a><span class="sd">        The names of the columns that the UDF will read. If None, then the</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a><span class="sd">        UDF will read all columns. This is only used when transforms is a</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a><span class="sd">        UDF. Otherwise, the read columns are inferred from the SQL expressions.</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a><span class="sd">    reader_schema: pa.Schema, optional</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a><span class="sd">        Only valid if transforms is a `ReaderLike` object.  This will be used to</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><span class="sd">        determine the schema of the reader.</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a><span class="sd">    batch_size: int, optional</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a><span class="sd">        The number of rows to read at a time from the source dataset when applying</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a><span class="sd">        the transform.  This is ignored if the dataset is a v1 dataset.</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a><span class="sd">    &gt;&gt;&gt; import lance</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="sd">    &gt;&gt;&gt; import pyarrow as pa</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><span class="sd">    &gt;&gt;&gt; table = pa.table({&quot;a&quot;: [1, 2, 3]})</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="sd">    &gt;&gt;&gt; dataset = lance.write_dataset(table, &quot;my_dataset&quot;)</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">    &gt;&gt;&gt; @lance.batch_udf()</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">    ... def double_a(batch):</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a><span class="sd">    ...     df = batch.to_pandas()</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><span class="sd">    ...     return pd.DataFrame({&#39;double_a&#39;: 2 * df[&#39;a&#39;]})</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a><span class="sd">    &gt;&gt;&gt; dataset.add_columns(double_a)</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><span class="sd">    &gt;&gt;&gt; dataset.to_table().to_pandas()</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><span class="sd">       a  double_a</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="sd">    0  1         2</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a><span class="sd">    1  2         4</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">    2  3         6</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">    &gt;&gt;&gt; dataset.add_columns({&quot;triple_a&quot;: &quot;a * 3&quot;})</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">    &gt;&gt;&gt; dataset.to_table().to_pandas()</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><span class="sd">       a  double_a  triple_a</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a><span class="sd">    0  1         2         3</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">    1  2         4         6</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">    2  3         6         9</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a><span class="sd">    See Also</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a><span class="sd">    LanceDataset.merge :</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><span class="sd">        Merge a pre-computed set of columns into the dataset.</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transforms</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>        <span class="n">transforms</span> <span class="o">=</span> <span class="p">[</span><span class="n">transforms</span><span class="p">]</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>        <span class="nb">isinstance</span><span class="p">(</span><span class="n">transforms</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transforms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">)</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>    <span class="p">):</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>        <span class="n">transforms</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transforms</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">Schema</span><span class="p">):</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">add_columns_with_schema</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>        <span class="k">return</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>    <span class="n">transforms</span> <span class="o">=</span> <span class="n">normalize_transform</span><span class="p">(</span><span class="n">transforms</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">read_columns</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">)</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transforms</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatchReader</span><span class="p">):</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">add_columns_from_reader</span><span class="p">(</span><span class="n">transforms</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>        <span class="k">return</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="n">transforms</span><span class="p">,</span> <span class="n">read_columns</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transforms</span><span class="p">,</span> <span class="n">BatchUDF</span><span class="p">):</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>            <span class="k">if</span> <span class="n">transforms</span><span class="o">.</span><span class="n">cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>                <span class="n">transforms</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h4 id="drop-columns">Drop Columns<a class="headerlink" href="#drop-columns" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.drop_columns"></a>
    <div class="doc doc-contents first">

        <p>Drop one or more columns from the dataset</p>
<p>This is a metadata-only operation and does not remove the data from the
underlying storage. In order to remove the data, you must subsequently
call <code>compact_files</code> to rewrite the data without the removed columns and
then call <code>cleanup_old_versions</code> to remove the old files.</p>
<h3 id="lance.dataset.LanceDataset.drop_columns--parameters">Parameters<a class="headerlink" href="#lance.dataset.LanceDataset.drop_columns--parameters" title="Permanent link">&para;</a></h3>
<p>columns : list of str
    The names of the columns to drop. These can be nested column references
    (e.g. "a.b.c") or top-level column names (e.g. "a").</p>
<h3 id="lance.dataset.LanceDataset.drop_columns--examples">Examples<a class="headerlink" href="#lance.dataset.LanceDataset.drop_columns--examples" title="Permanent link">&para;</a></h3>
<blockquote>
<blockquote>
<blockquote>
<p>import lance
import pyarrow as pa
table = pa.table({"a": [1, 2, 3], "b": ["a", "b", "c"]})
dataset = lance.write_dataset(table, "example")
dataset.drop_columns(["a"])
dataset.to_table().to_pandas()
   b
0  a
1  b
2  c</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1259" name="__codelineno-0-1259"></a><span class="k">def</span><span class="w"> </span><span class="nf">drop_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Drop one or more columns from the dataset</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a><span class="sd">    This is a metadata-only operation and does not remove the data from the</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a><span class="sd">    underlying storage. In order to remove the data, you must subsequently</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a><span class="sd">    call ``compact_files`` to rewrite the data without the removed columns and</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a><span class="sd">    then call ``cleanup_old_versions`` to remove the old files.</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a><span class="sd">    columns : list of str</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a><span class="sd">        The names of the columns to drop. These can be nested column references</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a><span class="sd">        (e.g. &quot;a.b.c&quot;) or top-level column names (e.g. &quot;a&quot;).</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a><span class="sd">    &gt;&gt;&gt; import lance</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a><span class="sd">    &gt;&gt;&gt; import pyarrow as pa</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a><span class="sd">    &gt;&gt;&gt; table = pa.table({&quot;a&quot;: [1, 2, 3], &quot;b&quot;: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]})</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a><span class="sd">    &gt;&gt;&gt; dataset = lance.write_dataset(table, &quot;example&quot;)</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a><span class="sd">    &gt;&gt;&gt; dataset.drop_columns([&quot;a&quot;])</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a><span class="sd">    &gt;&gt;&gt; dataset.to_table().to_pandas()</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a><span class="sd">       b</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a><span class="sd">    0  a</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a><span class="sd">    1  b</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="sd">    2  c</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">drop_columns</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>    <span class="c1"># Indices might have changed</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_list_indices_res</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="indexing-and-searching">Indexing and Searching<a class="headerlink" href="#indexing-and-searching" title="Permanent link">&para;</a></h3>
<h4 id="create-vector-index">Create Vector Index<a class="headerlink" href="#create-vector-index" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.create_index"></a>
    <div class="doc doc-contents first">

        <p>Create index on column.</p>
<p><strong>Experimental API</strong></p>
<h3 id="lance.dataset.LanceDataset.create_index--parameters">Parameters<a class="headerlink" href="#lance.dataset.LanceDataset.create_index--parameters" title="Permanent link">&para;</a></h3>
<p>column : str
    The column to be indexed.
index_type : str
    The type of the index.
    <code>"IVF_PQ, IVF_HNSW_PQ and IVF_HNSW_SQ"</code> are supported now.
name : str, optional
    The index name. If not provided, it will be generated from the
    column name.
metric : str
    The distance metric type, i.e., "L2" (alias to "euclidean"), "cosine"
    or "dot" (dot product). Default is "L2".
replace : bool
    Replace the existing index if it exists.
num_partitions : int, optional
    The number of partitions of IVF (Inverted File Index).
ivf_centroids : optional
    It can be either <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />class:<code>np.ndarray</code>,
    <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />class:<code>pyarrow.FixedSizeListArray</code> or
    <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />class:<code>pyarrow.FixedShapeTensorArray</code>.
    A <code>num_partitions x dimension</code> array of existing K-mean centroids
    for IVF clustering. If not provided, a new KMeans model will be trained.
pq_codebook : optional,
    It can be <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />class:<code>np.ndarray</code>, <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />class:<code>pyarrow.FixedSizeListArray</code>,
    or <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f5-1f1fe.svg" title=":py:" />class:<code>pyarrow.FixedShapeTensorArray</code>.
    A <code>num_sub_vectors x (2 ^ nbits * dimensions // num_sub_vectors)</code>
    array of K-mean centroids for PQ codebook.</p>
<div class="codehilite"><pre><span></span><code>Note: ``nbits`` is always 8 for now.
If not provided, a new PQ model will be trained.
</code></pre></div>

<p>num_sub_vectors : int, optional
    The number of sub-vectors for PQ (Product Quantization).
accelerator : str or <code>torch.Device</code>, optional
    If set, use an accelerator to speed up the training process.
    Accepted accelerator: "cuda" (Nvidia GPU) and "mps" (Apple Silicon GPU).
    If not set, use the CPU.
index_cache_size : int, optional
    The size of the index cache in number of entries. Default value is 256.
shuffle_partition_batches : int, optional
    The number of batches, using the row group size of the dataset, to include
    in each shuffle partition. Default value is 10240.</p>
<div class="codehilite"><pre><span></span><code>Assuming the row group size is 1024, each shuffle partition will hold
10240 * 1024 = 10,485,760 rows. By making this value smaller, this shuffle
will consume less memory but will take longer to complete, and vice versa.
</code></pre></div>

<p>shuffle_partition_concurrency : int, optional
    The number of shuffle partitions to process concurrently. Default value is 2</p>
<div class="codehilite"><pre><span></span><code>By making this value smaller, this shuffle will consume less memory but will
take longer to complete, and vice versa.
</code></pre></div>

<p>storage_options : optional, dict
    Extra options that make sense for a particular storage connection. This is
    used to store connection parameters like credentials, endpoint, etc.
filter_nan: bool
    Defaults to True. False is UNSAFE, and will cause a crash if any null/nan
    values are present (and otherwise will not). Disables the null filter used
    for nullable columns. Obtains a small speed boost.
one_pass_ivfpq: bool
    Defaults to False. If enabled, index type must be "IVF_PQ". Reduces disk IO.
kwargs :
    Parameters passed to the index building process.</p>
<p>The SQ (Scalar Quantization) is available for only <code>IVF_HNSW_SQ</code> index type,
this quantization method is used to reduce the memory usage of the index,
it maps the float vectors to integer vectors, each integer is of <code>num_bits</code>,
now only 8 bits are supported.</p>
<p>If <code>index_type</code> is "IVF_*", then the following parameters are required:
    num_partitions</p>
<p>If <code>index_type</code> is with "PQ", then the following parameters are required:
    num_sub_vectors</p>
<p>Optional parameters for <code>IVF_PQ</code>:</p>
<div class="codehilite"><pre><span></span><code>- ivf_centroids
    Existing K-mean centroids for IVF clustering.
- num_bits
    The number of bits for PQ (Product Quantization). Default is 8.
    Only 4, 8 are supported.
</code></pre></div>

<p>Optional parameters for <code>IVF_HNSW_*</code>:
    max_level
        Int, the maximum number of levels in the graph.
    m
        Int, the number of edges per node in the graph.
    ef_construction
        Int, the number of nodes to examine during the construction.</p>
<h3 id="lance.dataset.LanceDataset.create_index--examples">Examples<a class="headerlink" href="#lance.dataset.LanceDataset.create_index--examples" title="Permanent link">&para;</a></h3>
<p>.. code-block:: python</p>
<div class="codehilite"><pre><span></span><code>import lance

dataset = lance.dataset(&quot;/tmp/sift.lance&quot;)
dataset.create_index(
    &quot;vector&quot;,
    &quot;IVF_PQ&quot;,
    num_partitions=256,
    num_sub_vectors=16
)
</code></pre></div>

<p>.. code-block:: python</p>
<div class="codehilite"><pre><span></span><code>import lance

dataset = lance.dataset(&quot;/tmp/sift.lance&quot;)
dataset.create_index(
    &quot;vector&quot;,
    &quot;IVF_HNSW_SQ&quot;,
    num_partitions=256,
)
</code></pre></div>

<p>Experimental Accelerator (GPU) support:</p>
<ul>
<li><em>accelerate</em>: use GPU to train IVF partitions.
    Only supports CUDA (Nvidia) or MPS (Apple) currently.
    Requires PyTorch being installed.</li>
</ul>
<p>.. code-block:: python</p>
<div class="codehilite"><pre><span></span><code>import lance

dataset = lance.dataset(&quot;/tmp/sift.lance&quot;)
dataset.create_index(
    &quot;vector&quot;,
    &quot;IVF_PQ&quot;,
    num_partitions=256,
    num_sub_vectors=16,
    accelerator=&quot;cuda&quot;
)
</code></pre></div>

<h3 id="lance.dataset.LanceDataset.create_index--references">References<a class="headerlink" href="#lance.dataset.LanceDataset.create_index--references" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Faiss Index &lt;https://github.com/facebookresearch/faiss/wiki/Faiss-indexes&gt;</code>_</li>
<li>IVF introduced in <code>Video Google: a text retrieval approach to object matching
  in videos &lt;https://ieeexplore.ieee.org/abstract/document/1238663&gt;</code>_</li>
<li><code>Product quantization for nearest neighbor search
  &lt;https://hal.inria.fr/inria-00514462v2/document&gt;</code>_</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span>
<span class="normal"><a href="#__codelineno-0-2162">2162</a></span>
<span class="normal"><a href="#__codelineno-0-2163">2163</a></span>
<span class="normal"><a href="#__codelineno-0-2164">2164</a></span>
<span class="normal"><a href="#__codelineno-0-2165">2165</a></span>
<span class="normal"><a href="#__codelineno-0-2166">2166</a></span>
<span class="normal"><a href="#__codelineno-0-2167">2167</a></span>
<span class="normal"><a href="#__codelineno-0-2168">2168</a></span>
<span class="normal"><a href="#__codelineno-0-2169">2169</a></span>
<span class="normal"><a href="#__codelineno-0-2170">2170</a></span>
<span class="normal"><a href="#__codelineno-0-2171">2171</a></span>
<span class="normal"><a href="#__codelineno-0-2172">2172</a></span>
<span class="normal"><a href="#__codelineno-0-2173">2173</a></span>
<span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span>
<span class="normal"><a href="#__codelineno-0-2182">2182</a></span>
<span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span>
<span class="normal"><a href="#__codelineno-0-2207">2207</a></span>
<span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span>
<span class="normal"><a href="#__codelineno-0-2217">2217</a></span>
<span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span>
<span class="normal"><a href="#__codelineno-0-2223">2223</a></span>
<span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span>
<span class="normal"><a href="#__codelineno-0-2235">2235</a></span>
<span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span>
<span class="normal"><a href="#__codelineno-0-2280">2280</a></span>
<span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span>
<span class="normal"><a href="#__codelineno-0-2299">2299</a></span>
<span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span>
<span class="normal"><a href="#__codelineno-0-2303">2303</a></span>
<span class="normal"><a href="#__codelineno-0-2304">2304</a></span>
<span class="normal"><a href="#__codelineno-0-2305">2305</a></span>
<span class="normal"><a href="#__codelineno-0-2306">2306</a></span>
<span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span>
<span class="normal"><a href="#__codelineno-0-2312">2312</a></span>
<span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span>
<span class="normal"><a href="#__codelineno-0-2322">2322</a></span>
<span class="normal"><a href="#__codelineno-0-2323">2323</a></span>
<span class="normal"><a href="#__codelineno-0-2324">2324</a></span>
<span class="normal"><a href="#__codelineno-0-2325">2325</a></span>
<span class="normal"><a href="#__codelineno-0-2326">2326</a></span>
<span class="normal"><a href="#__codelineno-0-2327">2327</a></span>
<span class="normal"><a href="#__codelineno-0-2328">2328</a></span>
<span class="normal"><a href="#__codelineno-0-2329">2329</a></span>
<span class="normal"><a href="#__codelineno-0-2330">2330</a></span>
<span class="normal"><a href="#__codelineno-0-2331">2331</a></span>
<span class="normal"><a href="#__codelineno-0-2332">2332</a></span>
<span class="normal"><a href="#__codelineno-0-2333">2333</a></span>
<span class="normal"><a href="#__codelineno-0-2334">2334</a></span>
<span class="normal"><a href="#__codelineno-0-2335">2335</a></span>
<span class="normal"><a href="#__codelineno-0-2336">2336</a></span>
<span class="normal"><a href="#__codelineno-0-2337">2337</a></span>
<span class="normal"><a href="#__codelineno-0-2338">2338</a></span>
<span class="normal"><a href="#__codelineno-0-2339">2339</a></span>
<span class="normal"><a href="#__codelineno-0-2340">2340</a></span>
<span class="normal"><a href="#__codelineno-0-2341">2341</a></span>
<span class="normal"><a href="#__codelineno-0-2342">2342</a></span>
<span class="normal"><a href="#__codelineno-0-2343">2343</a></span>
<span class="normal"><a href="#__codelineno-0-2344">2344</a></span>
<span class="normal"><a href="#__codelineno-0-2345">2345</a></span>
<span class="normal"><a href="#__codelineno-0-2346">2346</a></span>
<span class="normal"><a href="#__codelineno-0-2347">2347</a></span>
<span class="normal"><a href="#__codelineno-0-2348">2348</a></span>
<span class="normal"><a href="#__codelineno-0-2349">2349</a></span>
<span class="normal"><a href="#__codelineno-0-2350">2350</a></span>
<span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1830" name="__codelineno-0-1830"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_index</span><span class="p">(</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>    <span class="n">column</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>    <span class="n">index_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;L2&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>    <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>    <span class="n">num_partitions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>    <span class="n">ivf_centroids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>        <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedSizeListArray</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedShapeTensorArray</span><span class="p">]</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>    <span class="n">pq_codebook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>        <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedSizeListArray</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedShapeTensorArray</span><span class="p">]</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>    <span class="n">num_sub_vectors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>    <span class="n">accelerator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;torch.Device&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>    <span class="n">index_cache_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>    <span class="n">shuffle_partition_batches</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>    <span class="n">shuffle_partition_concurrency</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>    <span class="c1"># experimental parameters</span>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>    <span class="n">ivf_centroids_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>    <span class="n">precomputed_partition_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>    <span class="n">storage_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>    <span class="n">filter_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>    <span class="n">one_pass_ivfpq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LanceDataset</span><span class="p">:</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create index on column.</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a><span class="sd">    **Experimental API**</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a><span class="sd">    column : str</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a><span class="sd">        The column to be indexed.</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a><span class="sd">    index_type : str</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a><span class="sd">        The type of the index.</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a><span class="sd">        ``&quot;IVF_PQ, IVF_HNSW_PQ and IVF_HNSW_SQ&quot;`` are supported now.</span>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a><span class="sd">    name : str, optional</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a><span class="sd">        The index name. If not provided, it will be generated from the</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a><span class="sd">        column name.</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a><span class="sd">    metric : str</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a><span class="sd">        The distance metric type, i.e., &quot;L2&quot; (alias to &quot;euclidean&quot;), &quot;cosine&quot;</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a><span class="sd">        or &quot;dot&quot; (dot product). Default is &quot;L2&quot;.</span>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a><span class="sd">    replace : bool</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875"></a><span class="sd">        Replace the existing index if it exists.</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a><span class="sd">    num_partitions : int, optional</span>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a><span class="sd">        The number of partitions of IVF (Inverted File Index).</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a><span class="sd">    ivf_centroids : optional</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a><span class="sd">        It can be either :py:class:`np.ndarray`,</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a><span class="sd">        :py:class:`pyarrow.FixedSizeListArray` or</span>
<a id="__codelineno-0-1881" name="__codelineno-0-1881"></a><span class="sd">        :py:class:`pyarrow.FixedShapeTensorArray`.</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882"></a><span class="sd">        A ``num_partitions x dimension`` array of existing K-mean centroids</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a><span class="sd">        for IVF clustering. If not provided, a new KMeans model will be trained.</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a><span class="sd">    pq_codebook : optional,</span>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a><span class="sd">        It can be :py:class:`np.ndarray`, :py:class:`pyarrow.FixedSizeListArray`,</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a><span class="sd">        or :py:class:`pyarrow.FixedShapeTensorArray`.</span>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a><span class="sd">        A ``num_sub_vectors x (2 ^ nbits * dimensions // num_sub_vectors)``</span>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a><span class="sd">        array of K-mean centroids for PQ codebook.</span>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>
<a id="__codelineno-0-1890" name="__codelineno-0-1890"></a><span class="sd">        Note: ``nbits`` is always 8 for now.</span>
<a id="__codelineno-0-1891" name="__codelineno-0-1891"></a><span class="sd">        If not provided, a new PQ model will be trained.</span>
<a id="__codelineno-0-1892" name="__codelineno-0-1892"></a><span class="sd">    num_sub_vectors : int, optional</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a><span class="sd">        The number of sub-vectors for PQ (Product Quantization).</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a><span class="sd">    accelerator : str or ``torch.Device``, optional</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a><span class="sd">        If set, use an accelerator to speed up the training process.</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a><span class="sd">        Accepted accelerator: &quot;cuda&quot; (Nvidia GPU) and &quot;mps&quot; (Apple Silicon GPU).</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a><span class="sd">        If not set, use the CPU.</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a><span class="sd">    index_cache_size : int, optional</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="sd">        The size of the index cache in number of entries. Default value is 256.</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a><span class="sd">    shuffle_partition_batches : int, optional</span>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a><span class="sd">        The number of batches, using the row group size of the dataset, to include</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a><span class="sd">        in each shuffle partition. Default value is 10240.</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><span class="sd">        Assuming the row group size is 1024, each shuffle partition will hold</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a><span class="sd">        10240 * 1024 = 10,485,760 rows. By making this value smaller, this shuffle</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="sd">        will consume less memory but will take longer to complete, and vice versa.</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a><span class="sd">    shuffle_partition_concurrency : int, optional</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><span class="sd">        The number of shuffle partitions to process concurrently. Default value is 2</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="sd">        By making this value smaller, this shuffle will consume less memory but will</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a><span class="sd">        take longer to complete, and vice versa.</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a><span class="sd">    storage_options : optional, dict</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a><span class="sd">        Extra options that make sense for a particular storage connection. This is</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a><span class="sd">        used to store connection parameters like credentials, endpoint, etc.</span>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a><span class="sd">    filter_nan: bool</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a><span class="sd">        Defaults to True. False is UNSAFE, and will cause a crash if any null/nan</span>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a><span class="sd">        values are present (and otherwise will not). Disables the null filter used</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a><span class="sd">        for nullable columns. Obtains a small speed boost.</span>
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a><span class="sd">    one_pass_ivfpq: bool</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a><span class="sd">        Defaults to False. If enabled, index type must be &quot;IVF_PQ&quot;. Reduces disk IO.</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a><span class="sd">    kwargs :</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a><span class="sd">        Parameters passed to the index building process.</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a><span class="sd">    The SQ (Scalar Quantization) is available for only ``IVF_HNSW_SQ`` index type,</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a><span class="sd">    this quantization method is used to reduce the memory usage of the index,</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a><span class="sd">    it maps the float vectors to integer vectors, each integer is of ``num_bits``,</span>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a><span class="sd">    now only 8 bits are supported.</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a><span class="sd">    If ``index_type`` is &quot;IVF_*&quot;, then the following parameters are required:</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a><span class="sd">        num_partitions</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a><span class="sd">    If ``index_type`` is with &quot;PQ&quot;, then the following parameters are required:</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a><span class="sd">        num_sub_vectors</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a><span class="sd">    Optional parameters for `IVF_PQ`:</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a><span class="sd">        - ivf_centroids</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a><span class="sd">            Existing K-mean centroids for IVF clustering.</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a><span class="sd">        - num_bits</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a><span class="sd">            The number of bits for PQ (Product Quantization). Default is 8.</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a><span class="sd">            Only 4, 8 are supported.</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a><span class="sd">    Optional parameters for `IVF_HNSW_*`:</span>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a><span class="sd">        max_level</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a><span class="sd">            Int, the maximum number of levels in the graph.</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a><span class="sd">        m</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a><span class="sd">            Int, the number of edges per node in the graph.</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a><span class="sd">        ef_construction</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a><span class="sd">            Int, the number of nodes to examine during the construction.</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a><span class="sd">    .. code-block:: python</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a><span class="sd">        import lance</span>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a><span class="sd">        dataset = lance.dataset(&quot;/tmp/sift.lance&quot;)</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a><span class="sd">        dataset.create_index(</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a><span class="sd">            &quot;vector&quot;,</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a><span class="sd">            &quot;IVF_PQ&quot;,</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a><span class="sd">            num_partitions=256,</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a><span class="sd">            num_sub_vectors=16</span>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a><span class="sd">        )</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a><span class="sd">    .. code-block:: python</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a><span class="sd">        import lance</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a><span class="sd">        dataset = lance.dataset(&quot;/tmp/sift.lance&quot;)</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a><span class="sd">        dataset.create_index(</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a><span class="sd">            &quot;vector&quot;,</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a><span class="sd">            &quot;IVF_HNSW_SQ&quot;,</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a><span class="sd">            num_partitions=256,</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a><span class="sd">        )</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a><span class="sd">    Experimental Accelerator (GPU) support:</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a><span class="sd">    - *accelerate*: use GPU to train IVF partitions.</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a><span class="sd">        Only supports CUDA (Nvidia) or MPS (Apple) currently.</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a><span class="sd">        Requires PyTorch being installed.</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a><span class="sd">    .. code-block:: python</span>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a><span class="sd">        import lance</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a><span class="sd">        dataset = lance.dataset(&quot;/tmp/sift.lance&quot;)</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a><span class="sd">        dataset.create_index(</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a><span class="sd">            &quot;vector&quot;,</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a><span class="sd">            &quot;IVF_PQ&quot;,</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a><span class="sd">            num_partitions=256,</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a><span class="sd">            num_sub_vectors=16,</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a><span class="sd">            accelerator=&quot;cuda&quot;</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a><span class="sd">        )</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a><span class="sd">    References</span>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a><span class="sd">    * `Faiss Index &lt;https://github.com/facebookresearch/faiss/wiki/Faiss-indexes&gt;`_</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a><span class="sd">    * IVF introduced in `Video Google: a text retrieval approach to object matching</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a><span class="sd">      in videos &lt;https://ieeexplore.ieee.org/abstract/document/1238663&gt;`_</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a><span class="sd">    * `Product quantization for nearest neighbor search</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a><span class="sd">      &lt;https://hal.inria.fr/inria-00514462v2/document&gt;`_</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>    <span class="c1"># Only support building index for 1 column from the API aspect, however</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>    <span class="c1"># the internal implementation might support building multi-column index later.</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>        <span class="n">column</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">]</span>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>    <span class="c1"># validate args</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> not found in schema&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>        <span class="n">is_multivec</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>        <span class="k">if</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_fixed_size_list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">):</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>            <span class="n">dimension</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">list_size</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>        <span class="k">elif</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_fixed_size_list</span><span class="p">(</span>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>            <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value_type</span>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>        <span class="p">):</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>            <span class="n">dimension</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value_type</span><span class="o">.</span><span class="n">list_size</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>            <span class="n">is_multivec</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>        <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>            <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedShapeTensorType</span><span class="p">)</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>        <span class="p">):</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>            <span class="n">dimension</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>                <span class="sa">f</span><span class="s2">&quot;Vector column </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> must be FixedSizeListArray &quot;</span>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>                <span class="sa">f</span><span class="s2">&quot;1-dimensional FixedShapeTensorArray, got </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>            <span class="p">)</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>        <span class="k">if</span> <span class="n">num_sub_vectors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dimension</span> <span class="o">%</span> <span class="n">num_sub_vectors</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>                <span class="sa">f</span><span class="s2">&quot;dimension (</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">) must be divisible by num_sub_vectors&quot;</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>                <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">num_sub_vectors</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>            <span class="p">)</span>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>        <span class="n">element_type</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value_type</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>        <span class="k">if</span> <span class="n">is_multivec</span><span class="p">:</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>            <span class="n">element_type</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value_type</span><span class="o">.</span><span class="n">value_type</span>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>            <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_floating</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_uint8</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>        <span class="p">):</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>                <span class="sa">f</span><span class="s2">&quot;Vector column </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> must have floating value type, &quot;</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a>                <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a>            <span class="p">)</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>        <span class="s2">&quot;l2&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>        <span class="s2">&quot;cosine&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>        <span class="s2">&quot;euclidean&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>        <span class="s2">&quot;dot&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>        <span class="s2">&quot;hamming&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>    <span class="p">]:</span>
<a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;metric_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>    <span class="n">index_type</span> <span class="o">=</span> <span class="n">index_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>    <span class="n">valid_index_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;IVF_FLAT&quot;</span><span class="p">,</span> <span class="s2">&quot;IVF_PQ&quot;</span><span class="p">,</span> <span class="s2">&quot;IVF_HNSW_PQ&quot;</span><span class="p">,</span> <span class="s2">&quot;IVF_HNSW_SQ&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>    <span class="k">if</span> <span class="n">index_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_index_types</span><span class="p">:</span>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>            <span class="sa">f</span><span class="s2">&quot;Only </span><span class="si">{</span><span class="n">valid_index_types</span><span class="si">}</span><span class="s2"> index types supported. Got </span><span class="si">{</span><span class="n">index_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>        <span class="p">)</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>    <span class="k">if</span> <span class="n">index_type</span> <span class="o">!=</span> <span class="s2">&quot;IVF_PQ&quot;</span> <span class="ow">and</span> <span class="n">one_pass_ivfpq</span><span class="p">:</span>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>            <span class="sa">f</span><span class="s1">&#39;one_pass_ivfpq requires index_type=&quot;IVF_PQ&quot;, got </span><span class="si">{</span><span class="n">index_type</span><span class="si">}</span><span class="s1">&#39;</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>        <span class="p">)</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>    <span class="c1"># Handle timing for various parts of accelerated builds</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>    <span class="n">timers</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>    <span class="k">if</span> <span class="n">one_pass_ivfpq</span> <span class="ow">and</span> <span class="n">accelerator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.vector</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-2079" name="__codelineno-0-2079"></a>            <span class="n">one_pass_assign_ivf_pq_on_accelerator</span><span class="p">,</span>
<a id="__codelineno-0-2080" name="__codelineno-0-2080"></a>            <span class="n">one_pass_train_ivf_pq_on_accelerator</span><span class="p">,</span>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a>        <span class="p">)</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Doing one-pass ivfpq accelerated computations&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a>        <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf+pq_train:start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a>        <span class="p">(</span>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>            <span class="n">ivf_centroids</span><span class="p">,</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>            <span class="n">ivf_kmeans</span><span class="p">,</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>            <span class="n">pq_codebook</span><span class="p">,</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>            <span class="n">pq_kmeans_list</span><span class="p">,</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">one_pass_train_ivf_pq_on_accelerator</span><span class="p">(</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>            <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>            <span class="n">num_partitions</span><span class="p">,</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>            <span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>            <span class="n">accelerator</span><span class="p">,</span>
<a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>            <span class="n">num_sub_vectors</span><span class="o">=</span><span class="n">num_sub_vectors</span><span class="p">,</span>
<a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">20480</span><span class="p">,</span>
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>            <span class="n">filter_nan</span><span class="o">=</span><span class="n">filter_nan</span><span class="p">,</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>        <span class="p">)</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>        <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf+pq_train:end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>        <span class="n">ivfpq_train_time</span> <span class="o">=</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf+pq_train:end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf+pq_train:start&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ivf+pq training time: </span><span class="si">%s</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">ivfpq_train_time</span><span class="p">)</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>        <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf+pq_assign:start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>        <span class="n">shuffle_output_dir</span><span class="p">,</span> <span class="n">shuffle_buffers</span> <span class="o">=</span> <span class="n">one_pass_assign_ivf_pq_on_accelerator</span><span class="p">(</span>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>            <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>            <span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>            <span class="n">accelerator</span><span class="p">,</span>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>            <span class="n">ivf_kmeans</span><span class="p">,</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>            <span class="n">pq_kmeans_list</span><span class="p">,</span>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">20480</span><span class="p">,</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>            <span class="n">filter_nan</span><span class="o">=</span><span class="n">filter_nan</span><span class="p">,</span>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>        <span class="p">)</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>        <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf+pq_assign:end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>        <span class="n">ivfpq_assign_time</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>            <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf+pq_assign:end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf+pq_assign:start&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>        <span class="p">)</span>
<a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ivf+pq transform time: </span><span class="si">%s</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">ivfpq_assign_time</span><span class="p">)</span>
<a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>
<a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_shuffle_buffers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shuffle_buffers</span>
<a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_shuffle_buffers_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>            <span class="n">shuffle_output_dir</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span>
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>        <span class="p">)</span>
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>    <span class="k">if</span> <span class="n">index_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;IVF&quot;</span><span class="p">):</span>
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ivf_centroids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ivf_centroids_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>                <span class="s2">&quot;ivf_centroids and ivf_centroids_file&quot;</span>
<a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>                <span class="s2">&quot; cannot be provided at the same time&quot;</span>
<a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>            <span class="p">)</span>
<a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>
<a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>        <span class="k">if</span> <span class="n">ivf_centroids_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">pyarrow.fs</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileSystem</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134"></a>
<a id="__codelineno-0-2135" name="__codelineno-0-2135"></a>            <span class="n">fs</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">FileSystem</span><span class="o">.</span><span class="n">from_uri</span><span class="p">(</span><span class="n">ivf_centroids_file</span><span class="p">)</span>
<a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>            <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open_input_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-2137" name="__codelineno-0-2137"></a>                <span class="n">ivf_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-2138" name="__codelineno-0-2138"></a>            <span class="n">num_partitions</span> <span class="o">=</span> <span class="n">ivf_centroids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2139" name="__codelineno-0-2139"></a>
<a id="__codelineno-0-2140" name="__codelineno-0-2140"></a>        <span class="k">if</span> <span class="n">num_partitions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2141" name="__codelineno-0-2141"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2142" name="__codelineno-0-2142"></a>                <span class="s2">&quot;num_partitions and num_sub_vectors are required for IVF_PQ&quot;</span>
<a id="__codelineno-0-2143" name="__codelineno-0-2143"></a>            <span class="p">)</span>
<a id="__codelineno-0-2144" name="__codelineno-0-2144"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_partitions</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
<a id="__codelineno-0-2145" name="__codelineno-0-2145"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;num_partitions is float, converting to int&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2146" name="__codelineno-0-2146"></a>            <span class="n">num_partitions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_partitions</span><span class="p">)</span>
<a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_partitions</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-2148" name="__codelineno-0-2148"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-2149" name="__codelineno-0-2149"></a>                <span class="sa">f</span><span class="s2">&quot;num_partitions must be int, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">num_partitions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2150" name="__codelineno-0-2150"></a>            <span class="p">)</span>
<a id="__codelineno-0-2151" name="__codelineno-0-2151"></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;num_partitions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_partitions</span>
<a id="__codelineno-0-2152" name="__codelineno-0-2152"></a>
<a id="__codelineno-0-2153" name="__codelineno-0-2153"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">precomputed_partition_dataset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ivf_centroids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-2154" name="__codelineno-0-2154"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2155" name="__codelineno-0-2155"></a>                <span class="s2">&quot;ivf_centroids must be provided when&quot;</span>
<a id="__codelineno-0-2156" name="__codelineno-0-2156"></a>                <span class="s2">&quot; precomputed_partition_dataset is provided&quot;</span>
<a id="__codelineno-0-2157" name="__codelineno-0-2157"></a>            <span class="p">)</span>
<a id="__codelineno-0-2158" name="__codelineno-0-2158"></a>        <span class="k">if</span> <span class="n">precomputed_partition_dataset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using provided precomputed partition dataset&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>            <span class="n">precomputed_ds</span> <span class="o">=</span> <span class="n">LanceDataset</span><span class="p">(</span>
<a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>                <span class="n">precomputed_partition_dataset</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span>
<a id="__codelineno-0-2162" name="__codelineno-0-2162"></a>            <span class="p">)</span>
<a id="__codelineno-0-2163" name="__codelineno-0-2163"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
<a id="__codelineno-0-2164" name="__codelineno-0-2164"></a>                <span class="s2">&quot;PQ&quot;</span> <span class="ow">in</span> <span class="n">index_type</span>
<a id="__codelineno-0-2165" name="__codelineno-0-2165"></a>                <span class="ow">and</span> <span class="n">pq_codebook</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-2166" name="__codelineno-0-2166"></a>                <span class="ow">and</span> <span class="n">accelerator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-2167" name="__codelineno-0-2167"></a>                <span class="ow">and</span> <span class="s2">&quot;precomputed_partitions_file&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span>
<a id="__codelineno-0-2168" name="__codelineno-0-2168"></a>            <span class="p">):</span>
<a id="__codelineno-0-2169" name="__codelineno-0-2169"></a>                <span class="c1"># In this case, the precomputed partitions file would be used</span>
<a id="__codelineno-0-2170" name="__codelineno-0-2170"></a>                <span class="c1"># without being turned into a set of precomputed buffers, so it</span>
<a id="__codelineno-0-2171" name="__codelineno-0-2171"></a>                <span class="c1"># needs to have a very specific format</span>
<a id="__codelineno-0-2172" name="__codelineno-0-2172"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">precomputed_ds</span><span class="o">.</span><span class="n">get_fragments</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2173" name="__codelineno-0-2173"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2174" name="__codelineno-0-2174"></a>                        <span class="s2">&quot;precomputed_partition_dataset must have only one fragment&quot;</span>
<a id="__codelineno-0-2175" name="__codelineno-0-2175"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2176" name="__codelineno-0-2176"></a>                <span class="n">files</span> <span class="o">=</span> <span class="n">precomputed_ds</span><span class="o">.</span><span class="n">get_fragments</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_files</span><span class="p">()</span>
<a id="__codelineno-0-2177" name="__codelineno-0-2177"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2178" name="__codelineno-0-2178"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2179" name="__codelineno-0-2179"></a>                        <span class="s2">&quot;precomputed_partition_dataset must have only one files&quot;</span>
<a id="__codelineno-0-2180" name="__codelineno-0-2180"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2181" name="__codelineno-0-2181"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_partitions_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precomputed_partition_dataset</span>
<a id="__codelineno-0-2182" name="__codelineno-0-2182"></a>
<a id="__codelineno-0-2183" name="__codelineno-0-2183"></a>        <span class="k">if</span> <span class="n">accelerator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ivf_centroids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">one_pass_ivfpq</span><span class="p">:</span>
<a id="__codelineno-0-2184" name="__codelineno-0-2184"></a>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing new precomputed partition dataset&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2185" name="__codelineno-0-2185"></a>            <span class="c1"># Use accelerator to train ivf centroids</span>
<a id="__codelineno-0-2186" name="__codelineno-0-2186"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.vector</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-2187" name="__codelineno-0-2187"></a>                <span class="n">compute_partitions</span><span class="p">,</span>
<a id="__codelineno-0-2188" name="__codelineno-0-2188"></a>                <span class="n">train_ivf_centroids_on_accelerator</span><span class="p">,</span>
<a id="__codelineno-0-2189" name="__codelineno-0-2189"></a>            <span class="p">)</span>
<a id="__codelineno-0-2190" name="__codelineno-0-2190"></a>
<a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>            <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf_train:start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>            <span class="n">ivf_centroids</span><span class="p">,</span> <span class="n">kmeans</span> <span class="o">=</span> <span class="n">train_ivf_centroids_on_accelerator</span><span class="p">(</span>
<a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>                <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>                <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>                <span class="n">num_partitions</span><span class="p">,</span>
<a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>                <span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>                <span class="n">accelerator</span><span class="p">,</span>
<a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>                <span class="n">filter_nan</span><span class="o">=</span><span class="n">filter_nan</span><span class="p">,</span>
<a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>            <span class="p">)</span>
<a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>            <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf_train:end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>            <span class="n">ivf_train_time</span> <span class="o">=</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf_train:end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf_train:start&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ivf training time: </span><span class="si">%s</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">ivf_train_time</span><span class="p">)</span>
<a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>            <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf_assign:start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>            <span class="n">num_sub_vectors_cur</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>            <span class="k">if</span> <span class="s2">&quot;PQ&quot;</span> <span class="ow">in</span> <span class="n">index_type</span> <span class="ow">and</span> <span class="n">pq_codebook</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>                <span class="c1"># compute residual subspace columns in the same pass</span>
<a id="__codelineno-0-2207" name="__codelineno-0-2207"></a>                <span class="n">num_sub_vectors_cur</span> <span class="o">=</span> <span class="n">num_sub_vectors</span>
<a id="__codelineno-0-2208" name="__codelineno-0-2208"></a>            <span class="n">partitions_file</span> <span class="o">=</span> <span class="n">compute_partitions</span><span class="p">(</span>
<a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>                <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>                <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>                <span class="n">kmeans</span><span class="p">,</span>
<a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>                <span class="n">batch_size</span><span class="o">=</span><span class="mi">20480</span><span class="p">,</span>
<a id="__codelineno-0-2213" name="__codelineno-0-2213"></a>                <span class="n">num_sub_vectors</span><span class="o">=</span><span class="n">num_sub_vectors_cur</span><span class="p">,</span>
<a id="__codelineno-0-2214" name="__codelineno-0-2214"></a>                <span class="n">filter_nan</span><span class="o">=</span><span class="n">filter_nan</span><span class="p">,</span>
<a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>            <span class="p">)</span>
<a id="__codelineno-0-2216" name="__codelineno-0-2216"></a>            <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf_assign:end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2217" name="__codelineno-0-2217"></a>            <span class="n">ivf_assign_time</span> <span class="o">=</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf_assign:end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;ivf_assign:start&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2218" name="__codelineno-0-2218"></a>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ivf transform time: </span><span class="si">%s</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">ivf_assign_time</span><span class="p">)</span>
<a id="__codelineno-0-2219" name="__codelineno-0-2219"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_partitions_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partitions_file</span>
<a id="__codelineno-0-2220" name="__codelineno-0-2220"></a>
<a id="__codelineno-0-2221" name="__codelineno-0-2221"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ivf_centroids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pq_codebook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-2222" name="__codelineno-0-2222"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2223" name="__codelineno-0-2223"></a>                <span class="s2">&quot;ivf_centroids must be specified when pq_codebook is provided&quot;</span>
<a id="__codelineno-0-2224" name="__codelineno-0-2224"></a>            <span class="p">)</span>
<a id="__codelineno-0-2225" name="__codelineno-0-2225"></a>
<a id="__codelineno-0-2226" name="__codelineno-0-2226"></a>        <span class="k">if</span> <span class="n">ivf_centroids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2227" name="__codelineno-0-2227"></a>            <span class="c1"># User provided IVF centroids</span>
<a id="__codelineno-0-2228" name="__codelineno-0-2228"></a>            <span class="k">if</span> <span class="n">_check_for_numpy</span><span class="p">(</span><span class="n">ivf_centroids</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
<a id="__codelineno-0-2229" name="__codelineno-0-2229"></a>                <span class="n">ivf_centroids</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<a id="__codelineno-0-2230" name="__codelineno-0-2230"></a>            <span class="p">):</span>
<a id="__codelineno-0-2231" name="__codelineno-0-2231"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">ivf_centroids</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span>
<a id="__codelineno-0-2233" name="__codelineno-0-2233"></a>                    <span class="ow">or</span> <span class="n">ivf_centroids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">num_partitions</span>
<a id="__codelineno-0-2234" name="__codelineno-0-2234"></a>                <span class="p">):</span>
<a id="__codelineno-0-2235" name="__codelineno-0-2235"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2236" name="__codelineno-0-2236"></a>                        <span class="sa">f</span><span class="s2">&quot;Ivf centroids must be 2D array: (clusters, dim), &quot;</span>
<a id="__codelineno-0-2237" name="__codelineno-0-2237"></a>                        <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">ivf_centroids</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2238" name="__codelineno-0-2238"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2239" name="__codelineno-0-2239"></a>                <span class="k">if</span> <span class="n">ivf_centroids</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<a id="__codelineno-0-2240" name="__codelineno-0-2240"></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>                        <span class="s2">&quot;IVF centroids must be floating number&quot;</span>
<a id="__codelineno-0-2242" name="__codelineno-0-2242"></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">ivf_centroids</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2243" name="__codelineno-0-2243"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2244" name="__codelineno-0-2244"></a>                <span class="n">dim</span> <span class="o">=</span> <span class="n">ivf_centroids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ivf_centroids</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>                <span class="n">ivf_centroids</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedSizeListArray</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>            <span class="c1"># Convert it to RecordBatch because Rust side only accepts RecordBatch.</span>
<a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>            <span class="n">ivf_centroids_batch</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatch</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span>
<a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>                <span class="p">[</span><span class="n">ivf_centroids</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;_ivf_centroids&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>            <span class="p">)</span>
<a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ivf_centroids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivf_centroids_batch</span>
<a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>
<a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>    <span class="k">if</span> <span class="s2">&quot;PQ&quot;</span> <span class="ow">in</span> <span class="n">index_type</span><span class="p">:</span>
<a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>        <span class="k">if</span> <span class="n">num_sub_vectors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>                <span class="s2">&quot;num_partitions and num_sub_vectors are required for IVF_PQ&quot;</span>
<a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>            <span class="p">)</span>
<a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;num_sub_vectors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_sub_vectors</span>
<a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>
<a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>            <span class="n">pq_codebook</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>            <span class="ow">and</span> <span class="n">accelerator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>            <span class="ow">and</span> <span class="s2">&quot;precomputed_partitions_file&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span>
<a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">one_pass_ivfpq</span>
<a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>        <span class="p">):</span>
<a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing new precomputed shuffle buffers for PQ.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>            <span class="n">partitions_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_partitions_file&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_partitions_file&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>
<a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>            <span class="n">partitions_ds</span> <span class="o">=</span> <span class="n">LanceDataset</span><span class="p">(</span><span class="n">partitions_file</span><span class="p">)</span>
<a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>            <span class="c1"># Use accelerator to train pq codebook</span>
<a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.vector</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>                <span class="n">compute_pq_codes</span><span class="p">,</span>
<a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>                <span class="n">train_pq_codebook_on_accelerator</span><span class="p">,</span>
<a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>            <span class="p">)</span>
<a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>
<a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>            <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;pq_train:start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>            <span class="n">pq_codebook</span><span class="p">,</span> <span class="n">kmeans_list</span> <span class="o">=</span> <span class="n">train_pq_codebook_on_accelerator</span><span class="p">(</span>
<a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>                <span class="n">partitions_ds</span><span class="p">,</span>
<a id="__codelineno-0-2280" name="__codelineno-0-2280"></a>                <span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-2281" name="__codelineno-0-2281"></a>                <span class="n">accelerator</span><span class="o">=</span><span class="n">accelerator</span><span class="p">,</span>
<a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>                <span class="n">num_sub_vectors</span><span class="o">=</span><span class="n">num_sub_vectors</span><span class="p">,</span>
<a id="__codelineno-0-2283" name="__codelineno-0-2283"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">element_type</span><span class="o">.</span><span class="n">to_pandas_dtype</span><span class="p">(),</span>
<a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>            <span class="p">)</span>
<a id="__codelineno-0-2285" name="__codelineno-0-2285"></a>            <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;pq_train:end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2286" name="__codelineno-0-2286"></a>            <span class="n">pq_train_time</span> <span class="o">=</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;pq_train:end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;pq_train:start&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;pq training time: </span><span class="si">%s</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">pq_train_time</span><span class="p">)</span>
<a id="__codelineno-0-2288" name="__codelineno-0-2288"></a>            <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;pq_assign:start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2289" name="__codelineno-0-2289"></a>            <span class="n">shuffle_output_dir</span><span class="p">,</span> <span class="n">shuffle_buffers</span> <span class="o">=</span> <span class="n">compute_pq_codes</span><span class="p">(</span>
<a id="__codelineno-0-2290" name="__codelineno-0-2290"></a>                <span class="n">partitions_ds</span><span class="p">,</span>
<a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>                <span class="n">kmeans_list</span><span class="p">,</span>
<a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>                <span class="n">batch_size</span><span class="o">=</span><span class="mi">20480</span><span class="p">,</span>
<a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>            <span class="p">)</span>
<a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>            <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;pq_assign:end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>            <span class="n">pq_assign_time</span> <span class="o">=</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;pq_assign:end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;pq_assign:start&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;pq transform time: </span><span class="si">%s</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">pq_assign_time</span><span class="p">)</span>
<a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>            <span class="c1"># Save disk space</span>
<a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>            <span class="k">if</span> <span class="n">precomputed_partition_dataset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
<a id="__codelineno-0-2299" name="__codelineno-0-2299"></a>                <span class="n">partitions_file</span>
<a id="__codelineno-0-2300" name="__codelineno-0-2300"></a>            <span class="p">):</span>
<a id="__codelineno-0-2301" name="__codelineno-0-2301"></a>                <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-2302" name="__codelineno-0-2302"></a>                    <span class="s2">&quot;Temporary partitions file stored at </span><span class="si">%s</span><span class="s2">,&quot;</span>
<a id="__codelineno-0-2303" name="__codelineno-0-2303"></a>                    <span class="s2">&quot;you may want to delete it.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2304" name="__codelineno-0-2304"></a>                    <span class="n">partitions_file</span><span class="p">,</span>
<a id="__codelineno-0-2305" name="__codelineno-0-2305"></a>                <span class="p">)</span>
<a id="__codelineno-0-2306" name="__codelineno-0-2306"></a>
<a id="__codelineno-0-2307" name="__codelineno-0-2307"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_shuffle_buffers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shuffle_buffers</span>
<a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_shuffle_buffers_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2309" name="__codelineno-0-2309"></a>                <span class="n">shuffle_output_dir</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span>
<a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>            <span class="p">)</span>
<a id="__codelineno-0-2311" name="__codelineno-0-2311"></a>
<a id="__codelineno-0-2312" name="__codelineno-0-2312"></a>        <span class="k">if</span> <span class="n">pq_codebook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2313" name="__codelineno-0-2313"></a>            <span class="c1"># User provided IVF centroids</span>
<a id="__codelineno-0-2314" name="__codelineno-0-2314"></a>            <span class="k">if</span> <span class="n">_check_for_numpy</span><span class="p">(</span><span class="n">pq_codebook</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
<a id="__codelineno-0-2315" name="__codelineno-0-2315"></a>                <span class="n">pq_codebook</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<a id="__codelineno-0-2316" name="__codelineno-0-2316"></a>            <span class="p">):</span>
<a id="__codelineno-0-2317" name="__codelineno-0-2317"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-2318" name="__codelineno-0-2318"></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">pq_codebook</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span>
<a id="__codelineno-0-2319" name="__codelineno-0-2319"></a>                    <span class="ow">or</span> <span class="n">pq_codebook</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">num_sub_vectors</span>
<a id="__codelineno-0-2320" name="__codelineno-0-2320"></a>                    <span class="ow">or</span> <span class="n">pq_codebook</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">256</span>
<a id="__codelineno-0-2321" name="__codelineno-0-2321"></a>                <span class="p">):</span>
<a id="__codelineno-0-2322" name="__codelineno-0-2322"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2323" name="__codelineno-0-2323"></a>                        <span class="sa">f</span><span class="s2">&quot;PQ codebook must be 3D array: (sub_vectors, 256, dim), &quot;</span>
<a id="__codelineno-0-2324" name="__codelineno-0-2324"></a>                        <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">pq_codebook</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2325" name="__codelineno-0-2325"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2326" name="__codelineno-0-2326"></a>                <span class="k">if</span> <span class="n">pq_codebook</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<a id="__codelineno-0-2327" name="__codelineno-0-2327"></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-2328" name="__codelineno-0-2328"></a>                        <span class="s2">&quot;PQ codebook must be floating number&quot;</span>
<a id="__codelineno-0-2329" name="__codelineno-0-2329"></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">pq_codebook</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2330" name="__codelineno-0-2330"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2331" name="__codelineno-0-2331"></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pq_codebook</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-2332" name="__codelineno-0-2332"></a>                <span class="n">pq_codebook</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedSizeListArray</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span>
<a id="__codelineno-0-2333" name="__codelineno-0-2333"></a>                    <span class="n">values</span><span class="p">,</span> <span class="n">pq_codebook</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-2334" name="__codelineno-0-2334"></a>                <span class="p">)</span>
<a id="__codelineno-0-2335" name="__codelineno-0-2335"></a>            <span class="n">pq_codebook_batch</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatch</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span>
<a id="__codelineno-0-2336" name="__codelineno-0-2336"></a>                <span class="p">[</span><span class="n">pq_codebook</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;_pq_codebook&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2337" name="__codelineno-0-2337"></a>            <span class="p">)</span>
<a id="__codelineno-0-2338" name="__codelineno-0-2338"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pq_codebook&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pq_codebook_batch</span>
<a id="__codelineno-0-2339" name="__codelineno-0-2339"></a>
<a id="__codelineno-0-2340" name="__codelineno-0-2340"></a>    <span class="k">if</span> <span class="n">shuffle_partition_batches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2341" name="__codelineno-0-2341"></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shuffle_partition_batches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shuffle_partition_batches</span>
<a id="__codelineno-0-2342" name="__codelineno-0-2342"></a>    <span class="k">if</span> <span class="n">shuffle_partition_concurrency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2343" name="__codelineno-0-2343"></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shuffle_partition_concurrency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shuffle_partition_concurrency</span>
<a id="__codelineno-0-2344" name="__codelineno-0-2344"></a>
<a id="__codelineno-0-2345" name="__codelineno-0-2345"></a>    <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;final_create_index:start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2346" name="__codelineno-0-2346"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span>
<a id="__codelineno-0-2347" name="__codelineno-0-2347"></a>        <span class="n">column</span><span class="p">,</span> <span class="n">index_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">replace</span><span class="p">,</span> <span class="n">storage_options</span><span class="p">,</span> <span class="n">kwargs</span>
<a id="__codelineno-0-2348" name="__codelineno-0-2348"></a>    <span class="p">)</span>
<a id="__codelineno-0-2349" name="__codelineno-0-2349"></a>    <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;final_create_index:end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-2350" name="__codelineno-0-2350"></a>    <span class="n">final_create_index_time</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2351" name="__codelineno-0-2351"></a>        <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;final_create_index:end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timers</span><span class="p">[</span><span class="s2">&quot;final_create_index:start&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2352" name="__codelineno-0-2352"></a>    <span class="p">)</span>
<a id="__codelineno-0-2353" name="__codelineno-0-2353"></a>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Final create_index rust time: </span><span class="si">%s</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">final_create_index_time</span><span class="p">)</span>
<a id="__codelineno-0-2354" name="__codelineno-0-2354"></a>    <span class="c1"># Save disk space</span>
<a id="__codelineno-0-2355" name="__codelineno-0-2355"></a>    <span class="k">if</span> <span class="s2">&quot;precomputed_shuffle_buffers_path&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
<a id="__codelineno-0-2356" name="__codelineno-0-2356"></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_shuffle_buffers_path&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>    <span class="p">):</span>
<a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>            <span class="s2">&quot;Temporary shuffle buffers stored at </span><span class="si">%s</span><span class="s2">, you may want to delete it.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precomputed_shuffle_buffers_path&quot;</span><span class="p">],</span>
<a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>        <span class="p">)</span>
<a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h4 id="create-scalar-index">Create Scalar Index<a class="headerlink" href="#create-scalar-index" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.create_scalar_index"></a>
    <div class="doc doc-contents first">

        <p>Create a scalar index on a column.</p>
<p>Scalar indices, like vector indices, can be used to speed up scans.  A scalar
index can speed up scans that contain filter expressions on the indexed column.
For example, the following scan will be faster if the column <code>my_col</code> has
a scalar index:</p>
<p>.. code-block:: python</p>
<div class="codehilite"><pre><span></span><code>import lance

dataset = lance.dataset(&quot;/tmp/images.lance&quot;)
my_table = dataset.scanner(filter=&quot;my_col != 7&quot;).to_table()
</code></pre></div>

<p>Vector search with pre-filers can also benefit from scalar indices. For example,</p>
<p>.. code-block:: python</p>
<div class="codehilite"><pre><span></span><code>import lance

dataset = lance.dataset(&quot;/tmp/images.lance&quot;)
my_table = dataset.scanner(
    nearest=dict(
       column=&quot;vector&quot;,
       q=[1, 2, 3, 4],
       k=10,
    )
    filter=&quot;my_col != 7&quot;,
    prefilter=True
)
</code></pre></div>

<p>There are 5 types of scalar indices available today.</p>
<ul>
<li><code>BTREE</code>. The most common type is <code>BTREE</code>. This index is inspired
  by the btree data structure although only the first few layers of the btree
  are cached in memory.  It will
  perform well on columns with a large number of unique values and few rows per
  value.</li>
<li><code>BITMAP</code>. This index stores a bitmap for each unique value in the column.
  This index is useful for columns with a small number of unique values and
  many rows per value.</li>
<li><code>LABEL_LIST</code>. A special index that is used to index list
  columns whose values have small cardinality.  For example, a column that
  contains lists of tags (e.g. <code>["tag1", "tag2", "tag3"]</code>) can be indexed
  with a <code>LABEL_LIST</code> index.  This index can only speedup queries with
  <code>array_has_any</code> or <code>array_has_all</code> filters.</li>
<li><code>NGRAM</code>. A special index that is used to index string columns.  This index
  creates a bitmap for each ngram in the string.  By default we use trigrams.
  This index can currently speed up queries using the <code>contains</code> function
  in filters.</li>
<li><code>FTS/INVERTED</code>. It is used to index document columns. This index
  can conduct full-text searches. For example, a column that contains any word
  of query string "hello world". The results will be ranked by BM25.</li>
</ul>
<p>Note that the <code>LANCE_BYPASS_SPILLING</code> environment variable can be used to
bypass spilling to disk. Setting this to true can avoid memory exhaustion
issues (see <a href="https://github.com/apache/datafusion/issues/10073">https://github.com/apache/datafusion/issues/10073</a> for more info).</p>
<p><strong>Experimental API</strong></p>
<h3 id="lance.dataset.LanceDataset.create_scalar_index--parameters">Parameters<a class="headerlink" href="#lance.dataset.LanceDataset.create_scalar_index--parameters" title="Permanent link">&para;</a></h3>
<p>column : str
    The column to be indexed.  Must be a boolean, integer, float,
    or string column.
index_type : str
    The type of the index.  One of <code>"BTREE"</code>, <code>"BITMAP"</code>,
    <code>"LABEL_LIST"</code>, <code>"NGRAM"</code>, <code>"FTS"</code> or <code>"INVERTED"</code>.
name : str, optional
    The index name. If not provided, it will be generated from the
    column name.
replace : bool, default True
    Replace the existing index if it exists.</p>


<details class="with_position" open>
  <summary>bool, default True</summary>
  <p>This is for the <code>INVERTED</code> index. If True, the index will store the
positions of the words in the document, so that you can conduct phrase
query. This will significantly increase the index size.
It won't impact the performance of non-phrase queries even if it is set to
True.</p>
</details>        <p>base_tokenizer: str, default "simple"
    This is for the <code>INVERTED</code> index. The base tokenizer to use. The value
    can be:
    * "simple": splits tokens on whitespace and punctuation.
    * "whitespace": splits tokens on whitespace.
    * "raw": no tokenization.
language: str, default "English"
    This is for the <code>INVERTED</code> index. The language for stemming
    and stop words. This is only used when <code>stem</code> or <code>remove_stop_words</code> is true
max_token_length: Optional[int], default 40
    This is for the <code>INVERTED</code> index. The maximum token length.
    Any token longer than this will be removed.
lower_case: bool, default True
    This is for the <code>INVERTED</code> index. If True, the index will convert all
    text to lowercase.
stem: bool, default False
    This is for the <code>INVERTED</code> index. If True, the index will stem the
    tokens.
remove_stop_words: bool, default False
    This is for the <code>INVERTED</code> index. If True, the index will remove
    stop words.
ascii_folding: bool, default False
    This is for the <code>INVERTED</code> index. If True, the index will convert
    non-ascii characters to ascii characters if possible.
    This would remove accents like "" -&gt; "e".</p>
<h3 id="lance.dataset.LanceDataset.create_scalar_index--examples">Examples<a class="headerlink" href="#lance.dataset.LanceDataset.create_scalar_index--examples" title="Permanent link">&para;</a></h3>
<p>.. code-block:: python</p>
<div class="codehilite"><pre><span></span><code>import lance

dataset = lance.dataset(&quot;/tmp/images.lance&quot;)
dataset.create_index(
    &quot;category&quot;,
    &quot;BTREE&quot;,
)
</code></pre></div>

<p>Scalar indices can only speed up scans for basic filters using
equality, comparison, range (e.g. <code>my_col BETWEEN 0 AND 100</code>), and set
membership (e.g. <code>my_col IN (0, 1, 2)</code>)</p>
<p>Scalar indices can be used if the filter contains multiple indexed columns and
the filter criteria are AND'd or OR'd together
(e.g. <code>my_col &lt; 0 AND other_col&gt; 100</code>)</p>
<p>Scalar indices may be used if the filter contains non-indexed columns but,
depending on the structure of the filter, they may not be usable.  For example,
if the column <code>not_indexed</code> does not have a scalar index then the filter
<code>my_col = 0 OR not_indexed = 1</code> will not be able to use any scalar index on
<code>my_col</code>.</p>
<p>To determine if a scan is making use of a scalar index you can use
<code>explain_plan</code> to look at the query plan that lance has created.  Queries
that use scalar indices will either have a <code>ScalarIndexQuery</code> relation or a
<code>MaterializeIndex</code> operator.</p>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1608" name="__codelineno-0-1608"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_scalar_index</span><span class="p">(</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>    <span class="n">column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>    <span class="n">index_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BTREE&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BITMAP&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;LABEL_LIST&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;INVERTED&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FTS&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;NGRAM&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>    <span class="p">],</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>    <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a><span class="p">):</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a scalar index on a column.</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a><span class="sd">    Scalar indices, like vector indices, can be used to speed up scans.  A scalar</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a><span class="sd">    index can speed up scans that contain filter expressions on the indexed column.</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a><span class="sd">    For example, the following scan will be faster if the column ``my_col`` has</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a><span class="sd">    a scalar index:</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a><span class="sd">    .. code-block:: python</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a><span class="sd">        import lance</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a><span class="sd">        dataset = lance.dataset(&quot;/tmp/images.lance&quot;)</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a><span class="sd">        my_table = dataset.scanner(filter=&quot;my_col != 7&quot;).to_table()</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a><span class="sd">    Vector search with pre-filers can also benefit from scalar indices. For example,</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a><span class="sd">    .. code-block:: python</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a><span class="sd">        import lance</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a><span class="sd">        dataset = lance.dataset(&quot;/tmp/images.lance&quot;)</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a><span class="sd">        my_table = dataset.scanner(</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a><span class="sd">            nearest=dict(</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a><span class="sd">               column=&quot;vector&quot;,</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a><span class="sd">               q=[1, 2, 3, 4],</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a><span class="sd">               k=10,</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a><span class="sd">            )</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a><span class="sd">            filter=&quot;my_col != 7&quot;,</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a><span class="sd">            prefilter=True</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a><span class="sd">        )</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a><span class="sd">    There are 5 types of scalar indices available today.</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a><span class="sd">    * ``BTREE``. The most common type is ``BTREE``. This index is inspired</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a><span class="sd">      by the btree data structure although only the first few layers of the btree</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a><span class="sd">      are cached in memory.  It will</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a><span class="sd">      perform well on columns with a large number of unique values and few rows per</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a><span class="sd">      value.</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><span class="sd">    * ``BITMAP``. This index stores a bitmap for each unique value in the column.</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a><span class="sd">      This index is useful for columns with a small number of unique values and</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a><span class="sd">      many rows per value.</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a><span class="sd">    * ``LABEL_LIST``. A special index that is used to index list</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a><span class="sd">      columns whose values have small cardinality.  For example, a column that</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a><span class="sd">      contains lists of tags (e.g. ``[&quot;tag1&quot;, &quot;tag2&quot;, &quot;tag3&quot;]``) can be indexed</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a><span class="sd">      with a ``LABEL_LIST`` index.  This index can only speedup queries with</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a><span class="sd">      ``array_has_any`` or ``array_has_all`` filters.</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a><span class="sd">    * ``NGRAM``. A special index that is used to index string columns.  This index</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a><span class="sd">      creates a bitmap for each ngram in the string.  By default we use trigrams.</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a><span class="sd">      This index can currently speed up queries using the ``contains`` function</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a><span class="sd">      in filters.</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a><span class="sd">    * ``FTS/INVERTED``. It is used to index document columns. This index</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a><span class="sd">      can conduct full-text searches. For example, a column that contains any word</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a><span class="sd">      of query string &quot;hello world&quot;. The results will be ranked by BM25.</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a><span class="sd">    Note that the ``LANCE_BYPASS_SPILLING`` environment variable can be used to</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a><span class="sd">    bypass spilling to disk. Setting this to true can avoid memory exhaustion</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a><span class="sd">    issues (see https://github.com/apache/datafusion/issues/10073 for more info).</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a><span class="sd">    **Experimental API**</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a><span class="sd">    column : str</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a><span class="sd">        The column to be indexed.  Must be a boolean, integer, float,</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a><span class="sd">        or string column.</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a><span class="sd">    index_type : str</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a><span class="sd">        The type of the index.  One of ``&quot;BTREE&quot;``, ``&quot;BITMAP&quot;``,</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a><span class="sd">        ``&quot;LABEL_LIST&quot;``, ``&quot;NGRAM&quot;``, ``&quot;FTS&quot;`` or ``&quot;INVERTED&quot;``.</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a><span class="sd">    name : str, optional</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a><span class="sd">        The index name. If not provided, it will be generated from the</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a><span class="sd">        column name.</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a><span class="sd">    replace : bool, default True</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a><span class="sd">        Replace the existing index if it exists.</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a><span class="sd">    with_position: bool, default True</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a><span class="sd">        This is for the ``INVERTED`` index. If True, the index will store the</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a><span class="sd">        positions of the words in the document, so that you can conduct phrase</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a><span class="sd">        query. This will significantly increase the index size.</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a><span class="sd">        It won&#39;t impact the performance of non-phrase queries even if it is set to</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a><span class="sd">        True.</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a><span class="sd">    base_tokenizer: str, default &quot;simple&quot;</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a><span class="sd">        This is for the ``INVERTED`` index. The base tokenizer to use. The value</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a><span class="sd">        can be:</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a><span class="sd">        * &quot;simple&quot;: splits tokens on whitespace and punctuation.</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a><span class="sd">        * &quot;whitespace&quot;: splits tokens on whitespace.</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a><span class="sd">        * &quot;raw&quot;: no tokenization.</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a><span class="sd">    language: str, default &quot;English&quot;</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a><span class="sd">        This is for the ``INVERTED`` index. The language for stemming</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a><span class="sd">        and stop words. This is only used when `stem` or `remove_stop_words` is true</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a><span class="sd">    max_token_length: Optional[int], default 40</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a><span class="sd">        This is for the ``INVERTED`` index. The maximum token length.</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a><span class="sd">        Any token longer than this will be removed.</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a><span class="sd">    lower_case: bool, default True</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a><span class="sd">        This is for the ``INVERTED`` index. If True, the index will convert all</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a><span class="sd">        text to lowercase.</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a><span class="sd">    stem: bool, default False</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a><span class="sd">        This is for the ``INVERTED`` index. If True, the index will stem the</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a><span class="sd">        tokens.</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a><span class="sd">    remove_stop_words: bool, default False</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a><span class="sd">        This is for the ``INVERTED`` index. If True, the index will remove</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a><span class="sd">        stop words.</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a><span class="sd">    ascii_folding: bool, default False</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a><span class="sd">        This is for the ``INVERTED`` index. If True, the index will convert</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a><span class="sd">        non-ascii characters to ascii characters if possible.</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a><span class="sd">        This would remove accents like &quot;&quot; -&gt; &quot;e&quot;.</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a><span class="sd">    .. code-block:: python</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a><span class="sd">        import lance</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a><span class="sd">        dataset = lance.dataset(&quot;/tmp/images.lance&quot;)</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a><span class="sd">        dataset.create_index(</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a><span class="sd">            &quot;category&quot;,</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a><span class="sd">            &quot;BTREE&quot;,</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a><span class="sd">        )</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a><span class="sd">    Scalar indices can only speed up scans for basic filters using</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a><span class="sd">    equality, comparison, range (e.g. ``my_col BETWEEN 0 AND 100``), and set</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a><span class="sd">    membership (e.g. `my_col IN (0, 1, 2)`)</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a><span class="sd">    Scalar indices can be used if the filter contains multiple indexed columns and</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a><span class="sd">    the filter criteria are AND&#39;d or OR&#39;d together</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a><span class="sd">    (e.g. ``my_col &lt; 0 AND other_col&gt; 100``)</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a><span class="sd">    Scalar indices may be used if the filter contains non-indexed columns but,</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a><span class="sd">    depending on the structure of the filter, they may not be usable.  For example,</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a><span class="sd">    if the column ``not_indexed`` does not have a scalar index then the filter</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><span class="sd">    ``my_col = 0 OR not_indexed = 1`` will not be able to use any scalar index on</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a><span class="sd">    ``my_col``.</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a><span class="sd">    To determine if a scan is making use of a scalar index you can use</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a><span class="sd">    ``explain_plan`` to look at the query plan that lance has created.  Queries</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a><span class="sd">    that use scalar indices will either have a ``ScalarIndexQuery`` relation or a</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a><span class="sd">    ``MaterializeIndex`` operator.</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>        <span class="n">column</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">]</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>            <span class="s2">&quot;Scalar indices currently only support a single column&quot;</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>        <span class="p">)</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>    <span class="n">column</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>    <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> not found in schema&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>    <span class="n">index_type</span> <span class="o">=</span> <span class="n">index_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>    <span class="k">if</span> <span class="n">index_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;BTREE&quot;</span><span class="p">,</span> <span class="s2">&quot;BITMAP&quot;</span><span class="p">,</span> <span class="s2">&quot;NGRAM&quot;</span><span class="p">,</span> <span class="s2">&quot;LABEL_LIST&quot;</span><span class="p">,</span> <span class="s2">&quot;INVERTED&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>            <span class="p">(</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>                <span class="s1">&#39;Only &quot;BTREE&quot;, &quot;LABEL_LIST&quot;, &quot;INVERTED&quot;, &quot;NGRAM&quot;, &#39;</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>                <span class="s1">&#39;or &quot;BITMAP&quot; are supported for &#39;</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>                <span class="sa">f</span><span class="s2">&quot;scalar columns.  Received </span><span class="si">{</span><span class="n">index_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>            <span class="p">)</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>        <span class="p">)</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>    <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>    <span class="n">field_type</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field_type</span><span class="p">,</span> <span class="s2">&quot;storage_type&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>        <span class="n">field_type</span> <span class="o">=</span> <span class="n">field_type</span><span class="o">.</span><span class="n">storage_type</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>    <span class="k">if</span> <span class="n">index_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;BTREE&quot;</span><span class="p">,</span> <span class="s2">&quot;BITMAP&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>            <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_integer</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_floating</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_boolean</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_string</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_temporal</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_fixed_size_binary</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>        <span class="p">):</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>                <span class="sa">f</span><span class="s2">&quot;BTREE/BITMAP index column </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> must be int&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a>                <span class="s2">&quot;, float, bool, str, fixed-size-binary, or temporal &quot;</span><span class="p">,</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>            <span class="p">)</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>    <span class="k">elif</span> <span class="n">index_type</span> <span class="o">==</span> <span class="s2">&quot;LABEL_LIST&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_list</span><span class="p">(</span><span class="n">field_type</span><span class="p">):</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LABEL_LIST index column </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> must be a list&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>    <span class="k">elif</span> <span class="n">index_type</span> <span class="o">==</span> <span class="s2">&quot;NGRAM&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_string</span><span class="p">(</span><span class="n">field_type</span><span class="p">):</span>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NGRAM index column </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> must be a string&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>    <span class="k">elif</span> <span class="n">index_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;INVERTED&quot;</span><span class="p">,</span> <span class="s2">&quot;FTS&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>        <span class="n">value_type</span> <span class="o">=</span> <span class="n">field_type</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a>        <span class="k">if</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_list</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_large_list</span><span class="p">(</span><span class="n">field_type</span><span class="p">):</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>            <span class="n">value_type</span> <span class="o">=</span> <span class="n">field_type</span><span class="o">.</span><span class="n">value_type</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_string</span><span class="p">(</span><span class="n">value_type</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_large_string</span><span class="p">(</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>            <span class="n">value_type</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>        <span class="p">):</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>                <span class="sa">f</span><span class="s2">&quot;INVERTED index column </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> must be string, large string&quot;</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>                <span class="s2">&quot; or list of strings, but got </span><span class="si">{value_type}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>            <span class="p">)</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>    <span class="k">if</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_duration</span><span class="p">(</span><span class="n">field_type</span><span class="p">):</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>            <span class="sa">f</span><span class="s2">&quot;Scalar index column </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> cannot currently be a duration&quot;</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>        <span class="p">)</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">create_index</span><span class="p">([</span><span class="n">column</span><span class="p">],</span> <span class="n">index_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">replace</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h4 id="drop-index">Drop Index<a class="headerlink" href="#drop-index" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-function">



<a id="lance.dataset.LanceDataset.drop_index"></a>
    <div class="doc doc-contents first">

        <p>Drops an index from the dataset</p>
<p>Note: Indices are dropped by "index name".  This is not the same as the field
name. If you did not specify a name when you created the index then a name was
generated for you.  You can use the <code>list_indices</code> method to get the names of
the indices.</p>


            <details class="quote">
              <summary>Source code in <code>lance/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span>
<span class="normal"><a href="#__codelineno-0-2369">2369</a></span>
<span class="normal"><a href="#__codelineno-0-2370">2370</a></span>
<span class="normal"><a href="#__codelineno-0-2371">2371</a></span>
<span class="normal"><a href="#__codelineno-0-2372">2372</a></span>
<span class="normal"><a href="#__codelineno-0-2373">2373</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2364" name="__codelineno-0-2364"></a><span class="k">def</span><span class="w"> </span><span class="nf">drop_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2365" name="__codelineno-0-2365"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2366" name="__codelineno-0-2366"></a><span class="sd">    Drops an index from the dataset</span>
<a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>
<a id="__codelineno-0-2368" name="__codelineno-0-2368"></a><span class="sd">    Note: Indices are dropped by &quot;index name&quot;.  This is not the same as the field</span>
<a id="__codelineno-0-2369" name="__codelineno-0-2369"></a><span class="sd">    name. If you did not specify a name when you created the index then a name was</span>
<a id="__codelineno-0-2370" name="__codelineno-0-2370"></a><span class="sd">    generated for you.  You can use the `list_indices` method to get the names of</span>
<a id="__codelineno-0-2371" name="__codelineno-0-2371"></a><span class="sd">    the indices.</span>
<a id="__codelineno-0-2372" name="__codelineno-0-2372"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2373" name="__codelineno-0-2373"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds</span><span class="o">.</span><span class="n">drop_index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h2>
<p>More information can be found in the <a href="../py_modules/">API reference</a>.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/lancedb/lance" target="_blank" rel="noopener" title="Source on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://pypi.org/project/pylance/" target="_blank" rel="noopener" title="PyPI Package" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
    
    
    
    
    <a href="https://discord.gg/zMM32dvNtd" target="_blank" rel="noopener" title="Discord Community" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.sections", "navigation.top", "navigation.tracking", "content.tabs.link", "content.code.copy", "content.code.annotate", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../assets/extra.js"></script>
      
    
  </body>
</html>